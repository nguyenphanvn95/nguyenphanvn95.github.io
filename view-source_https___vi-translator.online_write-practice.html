<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luyện Viết Ngôn Ngữ với AI | Vi Translator - Công cụ dịch và học ngôn ngữ miễn phí</title>
    <meta content="Luyện viết và dịch từ tiếng Việt sang tiếng Anh, Đức, Nhật, Hàn, Trung với AI thông minh. Cải thiện kỹ năng viết, ngữ pháp và từ vựng hiệu quả."
          name="description">
    <meta content="luyện viết tiếng anh, AI dịch thuật, học tiếng anh, dịch tiếng đức, dịch tiếng nhật, dịch tiếng hàn, dịch tiếng trung, ngữ pháp tiếng anh, vi translator"
          name="keywords">
    <meta content="index, follow" name="robots">
    <meta content="Vi Translator" name="author">

    <!-- Canonical URL -->
    <link href="https://vi-translator.online/write-practice" rel="canonical">

    <!-- Open Graph / Facebook -->
    <meta content="website" property="og:type">
    <meta content="https://vi-translator.online/write-practice" property="og:url">
    <meta content="Luyện Viết Ngôn Ngữ với AI | Vi Translator" property="og:title">
    <meta content="Luyện viết và dịch từ tiếng Việt sang tiếng Anh, Đức, Nhật, Hàn, Trung với AI thông minh. Cải thiện kỹ năng viết hiệu quả."
          property="og:description">
    <meta content="https://vi-translator.online/img/background.png" property="og:image">
    <meta content="Vi Translator" property="og:site_name">

    <!-- Twitter Card -->
    <meta content="summary_large_image" name="twitter:card">
    <meta content="https://vi-translator.online/write-practice" name="twitter:url">
    <meta content="Luyện Viết Ngôn Ngữ với AI | Vi Translator" name="twitter:title">
    <meta content="Luyện viết và dịch từ tiếng Việt sang tiếng Anh, Đức, Nhật, Hàn, Trung với AI thông minh."
          name="twitter:description">
    <meta content="https://vi-translator.online/img/background.png" name="twitter:image">

    <!-- Structured Data (JSON-LD) -->
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebApplication",
            "name": "Luyện Viết Ngôn Ngữ với AI",
            "alternateName": "Vi Translator Writing Practice",
            "url": "https://vi-translator.online/write-practice",
            "description": "Luyện viết và dịch từ tiếng Việt sang tiếng Anh, Đức, Nhật, Hàn, Trung với AI thông minh. Cải thiện kỹ năng viết, ngữ pháp và từ vựng hiệu quả.",
            "applicationCategory": "EducationalApplication",
            "operatingSystem": "All",
            "browserRequirements": "Requires JavaScript",
            "publisher": {
                "@type": "Organization",
                "name": "Vi Translator",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://vi-translator.online/img/logo.png"
                }
            },
            "offers": {
                "@type": "Offer",
                "price": "0",
                "priceCurrency": "USD"
            },
            "featureList": [
                "AI-powered writing assistance",
                "Multi-language translation",
                "Grammar checking",
                "Vocabulary practice",
                "Real-time feedback"
            ]
        }
    </script>

    <!-- Favicon -->
    <link href="/img/favicon.ico" rel="icon" type="image/x-icon">

    <!-- CSS Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/mobile-warning.css" rel="stylesheet">

    <!-- Chart.js for modern charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HFFN3WC9YD"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'G-HFFN3WC9YD');
    </script>

    <style>
        :root {
            /* Modern color palette */
            --primary-color: #6366f1; /* Indigo 500 */
            --primary-light: #818cf8; /* Indigo 400 */
            --primary-dark: #4f46e5; /* Indigo 600 */
            --secondary-color: #0ea5e9; /* Sky 500 */
            --secondary-light: #38bdf8; /* Sky 400 */
            --accent-color: #f43f5e; /* Rose 500 */
            --accent-light: #fb7185; /* Rose 400 */
            --success-color: #10b981; /* Emerald 500 */
            --success-light: #34d399; /* Emerald 400 */
            --warning-color: #f59e0b; /* Amber 500 */
            --warning-light: #fbbf24; /* Amber 400 */
            --text-color: #111827; /* Gray 900 */
            --text-secondary: #4b5563; /* Gray 600 */
            --bg-light: #f8fafc; /* Slate 50 */
            --bg-card: #ffffff;
            --border-color: #e2e8f0; /* Slate 200 */

            /* Enhanced layout variables */
            --container-width: 1600px;
            --container-padding: 1rem;
            --header-height: 60px;
            --content-max-width: 1400px;
            --border-radius: 16px;
            --border-radius-sm: 12px;
            --border-radius-lg: 20px;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);

            /* New variables for paragraph states */
            --current-sentence-bg: rgba(99, 102, 241, 0.1);
            --completed-sentence-color: #4f46e5;
            --completed-sentence-hover-bg: rgba(99, 102, 241, 0.05);
            --original-text-bg: rgba(79, 70, 229, 0.1);
            --tooltip-bg: #334155; /* Slate 700 */
            --tooltip-text: #f8fafc; /* Slate 50 */
            --tooltip-border: #475569; /* Slate 600 */
            --tooltip-shadow: rgba(0, 0, 0, 0.2);

            --primary-gradient: linear-gradient(135deg, #6366f1, #4f46e5);
            --secondary-gradient: linear-gradient(135deg, #0ea5e9, #2563eb);
            --accent-gradient: linear-gradient(135deg, #f43f5e, #e11d48);
            --success-gradient: linear-gradient(135deg, #10b981, #059669);
            --warning-gradient: linear-gradient(135deg, #f59e0b, #d97706);

            --primary-shadow: 0 8px 16px -4px rgba(99, 102, 241, 0.2);
            --hover-transform: translateY(-2px);
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Spinner animation for loading states */
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 0 var(--container-padding);
            flex: 1;
        }

        header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem var(--container-padding);
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .logo {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            background: rgba(99, 102, 241, 0.1);
            border-radius: var(--border-radius);
            color: var(--primary-color);
            font-weight: 500;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .user-dropdown {
            position: relative;
        }

        .user-dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            z-index: 1000;
            display: none;
            margin-top: 0.5rem;
        }

        .user-dropdown-menu.show {
            display: block;
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            color: var(--text-color);
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .user-dropdown-item:hover {
            background: var(--bg-light);
            color: var(--text-color);
        }

        .user-dropdown-divider {
            height: 1px;
            background: var(--border-color);
            margin: 0.5rem 0;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn.primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .btn.primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.1), 0 2px 4px -1px rgba(99, 102, 241, 0.06);
        }

        .btn.secondary {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-light);
        }

        .btn.secondary:hover {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-color);
        }

        .btn.info {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .btn.info:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(33, 150, 243, 0.1), 0 2px 4px -1px rgba(33, 150, 243, 0.06);
        }

        .btn.warning {
            background: linear-gradient(135deg, var(--warning-color), var(--warning-light));
            color: white;
        }

        .btn.warning:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(245, 158, 11, 0.1), 0 2px 4px -1px rgba(245, 158, 11, 0.06);
        }

        .btn.success {
            background: var(--success-color);
            color: white;
        }

        .btn.success:hover {
            background: var(--success-light);
        }

        .btn svg {
            color: currentColor;
        }

        .footer {
            text-align: center;
            padding: 1rem;
            background: white;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: auto;
            box-shadow: var(--shadow-sm);
        }

        /* Config section styles - COMPACT VERSION */
        .config-section {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: 1.25rem;
            box-shadow: var(--shadow-lg);
            margin: 0.75rem auto;
            max-width: var(--content-max-width);
            display: none;
            padding-top: 0.5rem;
            margin-top: 0.5rem;
            position: relative;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        /* Tab content transitions */
        .tab-content {
            opacity: 1;
            transform: translateY(0);
        }

        .tab-content[style*="display: none"] {
            opacity: 0;
            transform: translateY(-10px);
        }

        /* Writing workspace transitions */
        .writing-workspace {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .writing-workspace[style*="display: none"] {
            opacity: 0;
            transform: translateY(-10px);
        }

        .form-group {
            margin-bottom: 0px !important;
        }

        .config-section h2 {
            color: var(--primary-color);
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
            font-weight: 700;
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        .config-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .config-card {
            flex: 1;
            min-width: 220px;
            background: white;
            border-radius: 16px;
            padding: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.06);
        }

        .config-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255, 255, 255, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .config-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: currentColor;
        }

        .config-card:hover::before {
            opacity: 1;
        }

        .config-card h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-color);
        }

        .config-card h3 svg {
            width: 18px;
            height: 18px;
            stroke-width: 2;
        }

        .form-group {
            margin-bottom: 0.75rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 500;
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.65rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: white;
            color: var(--text-color);
        }

        .form-control:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
            outline: none;
        }

        /* Center align input placeholder and text */
        input.form-control {
            text-align: center;
        }

        input.form-control::placeholder {
            text-align: center;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .difficulty-selection {
            position: relative;
            width: 100%;
            margin: 1rem 0;
            z-index: 9999;
        }

        .difficulty-dropdown {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: white;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 9999;
        }

        .difficulty-dropdown::after {
            content: '▼';
            font-size: 0.8em;
            color: var(--text-secondary);
            position: absolute; /* Position the arrow */
            right: 1rem; /* Move to the right */
        }

        .selected-level {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center; /* Center the content */
            flex: 1;
        }

        /* Style for language selector to match difficulty dropdown */
        select.form-control {
            appearance: none; /* Remove default arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
            padding-right: 2.5rem; /* Space for the arrow */
            text-align: center; /* Center the text */
            text-align-last: center; /* Center the selected option */
            padding-left: 2.5rem; /* Balance the padding for center alignment */
        }

        /* Center align dropdown options */
        select.form-control option {
            text-align: center;
        }

        /* Remove default arrow in IE */
        select.form-control::-ms-expand {
            display: none;
        }

        /* Ensure the text remains centered when dropdown is open */
        select.form-control:focus {
            text-align: center;
            text-align-last: center;
            border-color: var(--success-color);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        /* Add custom styles for Firefox */
        @-moz-document url-prefix() {
            select.form-control {
                text-align: center;
                text-align-last: center;
            }
            select.form-control option {
                text-align: center;
            }
        }

        .difficulty-cards {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            margin-top: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .difficulty-selection.open .difficulty-cards {
            display: block;
        }

        .difficulty-card {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--border-color);
        }

        .difficulty-card:last-child {
            border-bottom: none;
        }

        .difficulty-card:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        .difficulty-card.selected {
            background: rgba(99, 102, 241, 0.1);
        }

        .difficulty-card .level-icon {
            font-size: 1.5rem;
            margin-right: 0.75rem;
            color: var(--primary-color);
        }

        .difficulty-card .level-name {
            font-weight: 500;
            color: var(--text-color);
            flex: 1;
        }

        .difficulty-card .level-indicator {
            display: flex;
            gap: 3px;
            margin-left: auto;
        }

        .level-indicator span {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--border-color);
        }

        .difficulty-card[data-level="1"] .level-indicator span:nth-child(1) {
            background: var(--primary-color);
        }

        .difficulty-card[data-level="2"] .level-indicator span:nth-child(-n+2) {
            background: var(--primary-color);
        }

        .difficulty-card[data-level="3"] .level-indicator span:nth-child(-n+3) {
            background: var(--primary-color);
        }

        .difficulty-card[data-level="4"] .level-indicator span:nth-child(-n+4) {
            background: var(--primary-color);
        }

        .difficulty-card[data-level="5"] .level-indicator span {
            background: var(--primary-color);
        }

        /* Remove old difficulty slider styles */
        .difficulty-slider, .difficulty-labels {
            display: none;
        }

        .topic-list {
            margin-bottom: 1rem;
        }

        .submit-row {
            display: flex;
            justify-content: center;
            margin-top: 0.75rem;
        }

        .submit-btn {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%) !important;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 14px;
            font-weight: 600;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 20px rgba(67, 233, 123, 0.3);
            position: relative;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover {
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 8px 25px rgba(67, 233, 123, 0.4);
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:active {
            transform: translateY(-1px) scale(1.01);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 3px 12px rgba(67, 233, 123, 0.2);
        }

        .submit-btn svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            stroke-width: 2;
        }

        /* Writing workspace styles */
        .writing-workspace {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            margin: 2rem auto;
            width: 100%;
            max-width: 100%;
            display: none;
            padding-top: 10px;
            margin-top: 10px;
        }

        .workspace-header {
            margin-bottom: 0;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .workspace-title-container {
            display: flex;
            flex-direction: column;
        }

        .workspace-header h2 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .workspace-meta {
            color: var(--text-secondary);
            font-size: 0.9rem;
            background-color: var(--bg-light);
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
        }

        .progress-container {
            margin: 1rem 0;
        }

        .progress-bar {
            height: 10px;
            background: var(--bg-light);
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 999px;
            transition: width 0.5s ease;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* New layout structure with better adaptability */
        .workspace-main {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
            margin-top: 0.75rem;
            width: 100%;
            min-height: 665px;
        }

        .workspace-main.expanded {
            min-height: 820px; /* More space when expanded */
        }

        .workspace-content {
            position: relative;
            padding-bottom: 85px;
            height: 665px;
        }

        .workspace-content.expanded {
            height: auto;
            min-height: 800px;
        }

        /* Content panel with improved flexibility */
        .content-panel {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 1px solid var(--border-color);
            height: auto;
            min-height: 91%;
            display: flex;
            flex-direction: column;
        }

        /* Right panel with feedback should expand as needed */
        .content-panel.feedback-container {
            height: auto;
            min-height: 665px;
            max-height: calc(100vh - 110px);
        }

        .panel-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 0.85rem 1.2rem;
            font-weight: 600;
            font-size: 1.05rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .practice-timer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            color: white;
            font-weight: 500;
            font-size: 0.9rem;
            margin-left: 1rem;
            backdrop-filter: blur(4px);
        }

        .practice-timer i {
            color: white;
            opacity: 0.9;
        }

        #timer-display {
            min-width: 60px;
            text-align: center;
            font-family: monospace;
            color: white;
            font-size: 1rem;
            letter-spacing: 1px;
        }

        /* Ensure timer is visible when display: flex is set */
        #practice-timer[style*="display: flex"] {
            display: flex !important;
        }

        .panel-content {
            padding: 0.85rem;
            height: calc(100% - 60px);
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            width: 100%;
        }

        /* Expand when there's a lot of content */
        .panel-content.expanded {
            height: auto;
            min-height: calc(100% - 60px);
            max-height: none;
        }

        /* Vietnamese panel */
        .vietnamese-panel {
            min-height: 400px;
            max-height: 538px;
        }

        .vietnamese-text {
            margin-bottom: 1rem;
        }

        .vietnamese-sentence {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: var(--border-radius-sm);
            border-left: 4px solid #ddd;
            transition: var(--transition);
            background-color: var(--bg-light);
        }

        .vietnamese-sentence.active {
            border-left-color: var(--primary-color);
            background-color: rgba(79, 70, 229, 0.1);
            box-shadow: var(--shadow-sm);
        }

        .vietnamese-sentence.completed {
            border-left-color: var(--success-color);
        }

        /* Translation panel */
        .translation-panel {
            min-height: 200px;
            max-height: 200px;
            background: transparent;
            border: none;
        }

        .translation-panel .panel-content {
            padding: 0;
            height: auto;
        }

        .translation-area p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
        }

        .translation-input-container {
            margin-bottom: 0.5rem;
            position: relative;
        }

        .translation-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 0.35rem;
            padding: 8px 0;
        }

        .translation-input {
            width: 100%;
            padding: 0.85rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1.125rem;
            resize: vertical;
            min-height: 80px;
            max-height: 90px;
            transition: var(--transition);
            background: white;
        }

        .translation-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }

        /* Speech-to-Text Button Styles */
        .speech-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: #6b7280;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
            padding: 0;
        }

        .speech-btn:hover {
            background: #4b5563;
            transform: scale(1.05);
        }

        .speech-btn.listening {
            background: #dc2626;
            animation: pulse-listening 1.5s infinite;
        }

        .speech-btn.processing {
            background: #2563eb;
        }

        .speech-btn.error {
            background: #dc2626;
        }

        .speech-btn.disabled {
            background: #d1d5db;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .speech-btn .mic-icon {
            transition: all 0.2s ease;
        }

        .speech-btn.listening .mic-icon {
            animation: mic-bounce 0.6s ease-in-out infinite alternate;
        }

        .recording-pulse {
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #dc2626;
            border-radius: 50%;
            opacity: 0;
            animation: pulse-ring 1.5s infinite;
        }

        .speech-btn.listening .recording-pulse {
            opacity: 1;
        }

        /* Speech Status */
        .speech-status {
            position: absolute;
            top: 50px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 15;
        }

        .speech-status.listening {
            background: rgba(220, 38, 38, 0.9);
        }

        .speech-status.processing {
            background: rgba(37, 99, 235, 0.9);
        }

        .speech-status.error {
            background: rgba(220, 38, 38, 0.9);
        }

        /* Animations */
        @keyframes pulse-listening {
            0% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(220, 38, 38, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0);
            }
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }
            100% {
                transform: scale(1.2);
                opacity: 0;
            }
        }

        @keyframes mic-bounce {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-2px);
            }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .speech-btn {
                width: 32px;
                height: 32px;
                top: 8px;
                right: 8px;
            }

            .speech-btn .mic-icon {
                width: 16px;
                height: 16px;
            }

            .speech-status {
                top: 45px;
                right: 8px;
                font-size: 11px;
            }
        }

        .countdown-timer {
            display: none !important;
        }

        /* Hint button styles */
        .hint-btn {
            background-color: var(--warning-color);
            color: white;
            opacity: 0.5;
            cursor: not-allowed;
            min-width: 120px; /* Ensure button doesn't jump when text changes */
        }

        .hint-btn.enabled {
            opacity: 1;
            cursor: pointer;
        }

        .hint-btn.enabled:hover {
            background-color: var(--warning-light);
        }

        /* Hint popup styles */
        .hint-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            max-width: 600px;
            width: 90%;
            z-index: 1000;
        }

        .hint-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .hint-popup-header h3 {
            color: var(--primary-color);
            font-size: 1.25rem;
            margin: 0;
        }

        .hint-popup-header h3 .cached-indicator {
            font-size: 0.85rem;
            background-color: #e5e7eb;
            color: #4b5563;
            padding: 0.2rem 0.5rem;
            border-radius: 999px;
            margin-left: 0.5rem;
            vertical-align: middle;
        }

        .hint-popup-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem;
        }

        .hint-popup-close:hover {
            color: var(--text-color);
        }

        .hint-popup-content {
            margin-bottom: 1.5rem;
        }

        .hint-section {
            margin-bottom: 1.5rem;
        }

        .hint-section:last-child {
            margin-bottom: 0;
        }

        .hint-section h4 {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .vocabulary-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .vocabulary-item {
            background: var(--bg-light);
            padding: 0.75rem;
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
        }

        .vocabulary-item strong {
            color: var(--primary-color);
            display: block;
            margin-bottom: 0.25rem;
        }

        .sentence-structure {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
        }

        .hint-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 999;
        }

        /* Feedback panel optimized styles */
        .feedback-panel {
            background-color: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            margin-top: 0.75rem;
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            transition: all 0.3s ease;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transform: translateY(-10px);
            border: 1px solid var(--border-color);
        }

        .feedback-panel.visible {
            max-height: calc(100vh - 170px);
            overflow-y: auto;
            opacity: 1;
            transform: translateY(0);
        }

        .feedback-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.8rem;
            position: relative;
        }

        .feedback-result {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feedback-result.success {
            color: var(--success-color);
        }

        .feedback-result.success::before {
            content: "✓";
            margin-right: 5px;
        }

        .feedback-result.error {
            color: var(--accent-color);
        }

        .feedback-result.error::before {
            content: "✗";
            margin-right: 5px;
        }

        .feedback-score {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary-color);
            padding: 0.25rem 0.75rem;
            background: rgba(79, 70, 229, 0.1);
            border-radius: 20px;
        }

        .feedback-body {
            color: var(--text-secondary);
        }

        .feedback-section {
            margin-bottom: 1rem;
            padding: 1rem;
            padding-bottom: 1px;
            background-color: var(--bg-light);
            border-radius: var(--border-radius-sm);
            border-left: 4px solid var(--primary-color);
        }

        .feedback-section h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.4rem;
            color: var(--text-color);
            display: flex;
            align-items: center;
        }

        .feedback-section h4 svg {
            margin-right: 0.5rem;
            color: var(--primary-color);
        }

        #generalFeedback, #highlightedSuggestion {
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        .improvements-list {
            margin: 0.2rem 0;
            padding-left: 1.5rem;
            list-style-type: none;
        }

        .improvements-list li {
            font-size: 0.9rem;
            margin-bottom: 0.4rem;
            padding: 5px 8px;
            padding-left: 16px;
            line-height: 1.35;
            color: #F57F17;
            position: relative;
        }

        .improvements-list li::before {
            content: "•";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            color: #F57F17;
            font-weight: bold;
            font-size: 1.1rem;
            line-height: 1;
        }

        .highlight {
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-weight: 600;
            color: #D32F2F;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: inline-block;
            margin: 0 2px;
            position: relative;
            text-decoration: underline wavy #D32F2F;
            letter-spacing: 0.02em;
            animation: highlight-pulse 2s infinite;
        }

        @keyframes highlight-pulse {
            0% {
                opacity: 1;
            }
            50% {
                opacity: 0.8;
            }
            100% {
                opacity: 1;
            }
        }

        /* Previous translations */
        .previous-translations {
            margin-top: 1.5rem;
        }

        .previous-translations h4 {
            color: var(--primary-color);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .previous-translation-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-radius: var(--border-radius-sm);
            background-color: var(--bg-light);
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }

        .previous-translation-item strong {
            color: var(--primary-color);
        }

        .previous-translation-item:last-child {
            margin-bottom: 0;
        }

        /* Completion summary */
        .completion-summary {
            background-color: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            margin-top: 2rem;
            display: none;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .summary-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .summary-header h2 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .overall-score {
            font-size: 3rem;
            font-weight: 700;
            color: var(--success-color);
            display: block;
            text-align: center;
            margin: 1rem 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .summary-sections {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .summary-section {
            background-color: var(--bg-light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .summary-section h3 {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
        }

        .summary-section h3 svg {
            color: var(--primary-color);
        }

        .summary-list {
            list-style-type: none;
        }

        .summary-list li {
            margin-bottom: 0.75rem;
            padding: 0.5rem 0.75rem 0.5rem 1.5rem;
            position: relative;
            background-color: white;
            border-radius: 6px;
            font-size: 0.95rem;
        }

        .summary-list li:before {
            content: '•';
            position: absolute;
            left: 0.5rem;
            color: var(--primary-color);
        }

        .summary-actions {
            text-align: center;
            margin-top: 2rem;
        }

        /* Keyboard shortcuts panel */
        .keyboard-shortcuts {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--shadow-md);
            font-size: 0.9rem;
            z-index: 100;
            display: none;
            border: 1px solid var(--border-color);
        }

        .keyboard-shortcuts.visible {
            display: block;
        }

        .keyboard-shortcuts h4 {
            margin-bottom: 0.75rem;
            color: var(--primary-color);
        }

        .shortcut-list {
            list-style-type: none;
        }

        .shortcut-list li {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }

        .shortcut-key {
            background-color: var(--primary-color);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            margin-right: 0.5rem;
            font-family: monospace;
            font-weight: 600;
        }

        /* Mobile warning styles */
        html.mobile-warning-shown,
        html.mobile-warning-shown body {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .mobile-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.9);
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            touch-action: none;
            -webkit-overflow-scrolling: none;
        }

        .mobile-warning-content {
            position: relative;
            width: min(90%, 300px);
            height: min(85vh, 600px);
            background: #ffffff;
            border-radius: 24px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideUpFade 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            overflow: hidden;
        }

        .mobile-warning-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            width: 100%;
            padding: 0.5rem;
            overflow: hidden;
        }

        .mobile-warning-illustration {
            width: 80px;
            height: 80px;
            flex-shrink: 0;
            border-radius: 40px;
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 12px 24px -8px rgba(99, 102, 241, 0.5);
            margin: 0 auto 0.5rem;
        }

        .mobile-warning-text {
            color: #1f2937;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
        }

        .mobile-warning h2 {
            font-size: 1.125rem;
            font-weight: 700;
            line-height: 1.3;
            background: linear-gradient(135deg, #4f46e5, #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
            padding: 0;
        }

        .mobile-warning p {
            font-size: 0.875rem;
            line-height: 1.5;
            color: #4b5563;
            margin: 0;
            padding: 0;
        }

        .mobile-warning-actions {
            width: 100%;
            padding: 0.75rem 0 0;
            flex-shrink: 0;
        }

        .mobile-warning .btn-primary {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            padding: 0.75rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            border: none;
            width: 100%;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25);
            white-space: nowrap;
        }

        .mobile-warning .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(79, 70, 229, 0.3);
        }

        .mobile-warning .btn-primary:active {
            transform: translateY(0);
        }

        .mobile-warning .btn-primary svg {
            width: 14px;
            height: 14px;
            stroke-width: 2;
            flex-shrink: 0;
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile warning responsive adjustments */
        @media (max-width: 380px) {
            .mobile-warning-content {
                width: min(100%, 276px);
                height: min(90vh, 335px);
                padding: 1rem;
            }

            .mobile-warning-main {
                gap: 1rem;
            }

            .mobile-warning-illustration {
                width: 64px;
                height: 64px;
                border-radius: 32px;
            }

            .mobile-warning-text {
                gap: 0.75rem;
            }

            .mobile-warning h2 {
                font-size: 1rem;
            }

            .mobile-warning p {
                font-size: 0.8125rem;
            }

            .mobile-warning-actions {
                padding: 0.5rem 0 0;
            }

            .mobile-warning .btn-primary {
                padding: 0.625rem;
                font-size: 0.8125rem;
            }

            .mobile-warning .btn-primary svg {
                width: 12px;
                height: 12px;
            }
        }

        /* Loading overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1001;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
            backdrop-filter: blur(5px);
            padding: 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 2rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            font-size: 1.2rem;
            font-weight: 500;
            text-align: center;
            max-width: 80%;
            line-height: 1.5;
            margin: 0 auto;
        }

        #loadingMessage {
            display: inline-block;
            text-align: center;
            width: 100%;
            max-width: 600px;
        }

        #loadingMessage span {
            display: inline;
            white-space: normal;
            word-wrap: break-word;
        }

        /* Loading container to ensure proper centering */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Updated panel styles */
        .paragraph-panel {
            min-height: 230px;
            max-height: 430px;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            display: flex;
            flex-direction: column;
        }

        .paragraph-panel .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
            padding-top: 8px;
            padding-bottom: 16px;
            scroll-behavior: smooth;
        }

        .paragraph-text {
            font-size: 1.05rem;
            line-height: 1.7;
            color: var(--text-color);
            padding: 0.25rem;
            padding-bottom: 28px;
        }

        /* Sentence styles */
        .sentence {
            display: inline;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            font-size: 15px;
        }

        .sentence.current {
            background-color: var(--current-sentence-bg);
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(99, 102, 241, 0.2);
            scroll-margin: 1rem;
        }

        /* Custom scrollbar for paragraph panel */
        .paragraph-panel .panel-content::-webkit-scrollbar {
            width: 8px;
        }

        .paragraph-panel .panel-content::-webkit-scrollbar-track {
            background: var(--bg-light);
            border-radius: 4px;
        }

        .paragraph-panel .panel-content::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 4px;
            border: 2px solid var(--bg-light);
        }

        .paragraph-panel .panel-content::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* Fade effect for long content */
        .paragraph-panel .panel-content::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(to top, var(--bg-card), transparent);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .paragraph-panel .panel-content.has-overflow::after {
            opacity: 1;
        }

        .config-card h3 {
            font-size: 19px;
        }

        .translation-section {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            z-index: 5;
            padding: 12px;
            border-top: 1px solid var(--border-color);
        }

        /* Giảm kích thước nút để vừa vặn và gọn gàng hơn */
        .btn.warning, .hint-btn {
            padding: 0px 18px;
            font-size: 0.95rem;
            min-height: 49px;
            min-width: 120px;
        }

        .btn.primary {
            padding: 14px 24px;
            font-size: 0.95rem;
            min-height: 38px;
            min-width: 120px;
        }

        /* Điều chỉnh lại content container */
        .content-panel {
            height: auto;
            min-height: 91%;
            display: flex;
            flex-direction: column;
        }

        /* Điều chỉnh paragrah text */
        .paragraph-text {
            font-size: 1.05rem;
            line-height: 1.7;
            padding: 0.25rem;
            padding-bottom: 28px;
        }

        /* Điều chỉnh feedback content */
        .feedback-content {
            padding: 0.75rem;
        }

        /* Giảm khoảng cách của feedback panel */
        #generalFeedbackSection {
            margin-bottom: 1rem;
            padding: 1rem;
        }

        /* Responsive adjustments */
        @media (max-height: 800px) {
            .workspace-main {
                min-height: 650px;
            }

            .workspace-content {
                height: 650px;
            }

            .paragraph-panel {
                min-height: 200px;
                max-height: 400px;
            }

            .feedback-panel.visible {
                max-height: calc(100vh - 200px);
            }
        }

        /* Fix scrolling issues */
        html, body {
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        /* Chỉnh nút phím tắt nhỏ gọn hơn */
        #showShortcutsBtn {
            padding: 5px 12px;
            font-size: 0.85rem;
            height: 34px;
        }

        #suggestedSection {
            display: none; /* Hide by default */
            border-left-color: #D32F2F;
            background-color: #FFEBEE;
            margin-bottom: 1rem;
            padding: 1rem;
        }

        #suggestedSection.visible {
            display: block;
        }

        #suggestedSection h4 {
            color: #D32F2F;
            margin-bottom: 0.4rem;
        }

        #suggestedSection h4 svg {
            color: #D32F2F;
        }

        #highlightedSuggestion {
            line-height: 1.8;
            padding: 12px;
            border-radius: 6px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            font-size: 0.95rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Make selectors more specific and add !important for critical styles */
        #suggestedSection #highlightedSuggestion strong,
        #suggestedSection #highlightedSuggestion .highlight {
            color: #D32F2F !important;
            font-weight: 600 !important;
            padding: 0 2px;
            display: inline-block;
            animation: highlight-glow 2s ease-in-out infinite;
        }

        @keyframes highlight-glow {
            0% {
                text-shadow: 0 0 2px rgba(211, 47, 47, 0.2);
            }
            50% {
                text-shadow: 0 0 8px rgba(211, 47, 47, 0.4);
            }
            100% {
                text-shadow: 0 0 2px rgba(211, 47, 47, 0.2);
            }
        }

        /* Ensure the section is visible when needed */
        #suggestedSection.visible {
            display: block !important;
        }

        /* Language select styles */
        .language-select {
            padding-left: 40px !important; /* Space for flag */
            position: relative;
            background-position: 10px center;
            background-repeat: no-repeat;
            background-size: 20px auto;
        }

        .language-select option {
            padding-left: 40px;
            height: 30px;
            display: flex;
            align-items: center;
        }

        .flag-svg {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            vertical-align: middle;
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* Custom select with flags */
        .language-select-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .language-select-container::before {
            content: "";
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            pointer-events: none;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .modal-content.info {
            border-top: 4px solid #2196F3;
        }

        .modal-content.info .modal-icon svg {
            stroke: #2196F3;
        }

        <
        !
        DOCTYPE html >

        <
        html xmlns:th

        =
        "http://www.thymeleaf.org"
        >

        <
        head >

        <
        meta charset

        =
        "UTF-8"
        >

        <
        meta name

        =
        "viewport"
        content

        =
        "width=device-width, initial-scale=1.0"
        >

        <
        title > Luyện Viết Ngôn Ngữ với AI | Vi Translator

        -
        Công cụ dịch và học ngôn ngữ miễn phí

        <
        /
        title >
    <meta name="description" content="Luyện viết và dịch từ tiếng Việt sang các ngôn ngữ khác với trợ giúp của AI. Cải thiện kỹ năng viết và từ vựng của bạn.">
    
    <!-- Favicon -->
    <link rel="icon" href="/img/favicon.ico" type="image/x-icon">
    
    <!-- CSS Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/css/mobile-warning.css" rel="stylesheet">
    
    <!-- Chart.js for modern charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HFFN3WC9YD"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'G-HFFN3WC9YD');
    </script>

    <style>
        :root {
            /* Modern color palette */
            --primary-color: #6366f1; /* Indigo 500 */
            --primary-light: #818cf8; /* Indigo 400 */
            --primary-dark: #4f46e5; /* Indigo 600 */
            --secondary-color: #0ea5e9; /* Sky 500 */
            --secondary-light: #38bdf8; /* Sky 400 */
            --accent-color: #f43f5e; /* Rose 500 */
            --accent-light: #fb7185; /* Rose 400 */
            --success-color: #10b981; /* Emerald 500 */
            --success-light: #34d399; /* Emerald 400 */
            --warning-color: #f59e0b; /* Amber 500 */
            --warning-light: #fbbf24; /* Amber 400 */
            --text-color: #111827; /* Gray 900 */
            --text-secondary: #4b5563; /* Gray 600 */
            --bg-light: #f8fafc; /* Slate 50 */
            --bg-card: #ffffff;
            --border-color: #e2e8f0; /* Slate 200 */
            
            /* Enhanced layout variables */
            --container-width: 1600px;
            --container-padding: 1rem;
            --header-height: 60px;
            --content-max-width: 1400px;
            --border-radius: 16px;
            --border-radius-sm: 12px;
            --border-radius-lg: 20px;
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            
            /* New variables for paragraph states */
            --current-sentence-bg: rgba(99, 102, 241, 0.1);
            --completed-sentence-color: #4f46e5;
            --completed-sentence-hover-bg: rgba(99, 102, 241, 0.05);
            --original-text-bg: rgba(79, 70, 229, 0.1);
            --tooltip-bg: #334155; /* Slate 700 */
            --tooltip-text: #f8fafc; /* Slate 50 */
            --tooltip-border: #475569; /* Slate 600 */
            --tooltip-shadow: rgba(0, 0, 0, 0.2);
            
            --primary-gradient: linear-gradient(135deg, #6366f1, #4f46e5);
            --secondary-gradient: linear-gradient(135deg, #0ea5e9, #2563eb);
            --accent-gradient: linear-gradient(135deg, #f43f5e, #e11d48);
            --success-gradient: linear-gradient(135deg, #10b981, #059669);
            --warning-gradient: linear-gradient(135deg, #f59e0b, #d97706);
            
            --primary-shadow: 0 8px 16px -4px rgba(99, 102, 241, 0.2);
            --hover-transform: translateY(-2px);
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Spinner animation for loading states */
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 0 var(--container-padding);
            flex: 1;
        }

        header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem var(--container-padding);
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .logo {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            background: rgba(99, 102, 241, 0.1);
            border-radius: var(--border-radius);
            color: var(--primary-color);
            font-weight: 500;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .user-dropdown {
            position: relative;
        }

        .user-dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            min-width: 200px;
            z-index: 1000;
            display: none;
            margin-top: 0.5rem;
        }

        .user-dropdown-menu.show {
            display: block;
        }

        .user-dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            color: var(--text-color);
            text-decoration: none;
            transition: background-color 0.2s;
        }

        .user-dropdown-item:hover {
            background: var(--bg-light);
            color: var(--text-color);
        }

        .user-dropdown-divider {
            height: 1px;
            background: var(--border-color);
            margin: 0.5rem 0;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn.primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .btn.primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.1), 0 2px 4px -1px rgba(99, 102, 241, 0.06);
        }

        .btn.secondary {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-light);
        }

        .btn.secondary:hover {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-color);
        }

        .btn.info {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .btn.info:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(33, 150, 243, 0.1), 0 2px 4px -1px rgba(33, 150, 243, 0.06);
        }

        .btn.warning {
            background: linear-gradient(135deg, var(--warning-color), var(--warning-light));
            color: white;
        }

        .btn.warning:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(245, 158, 11, 0.1), 0 2px 4px -1px rgba(245, 158, 11, 0.06);
        }

        .btn.success {
            background: var(--success-color);
            color: white;
        }

        .btn.success:hover {
            background: var(--success-light);
        }

        .btn svg {
            color: currentColor;
        }

        .footer {
            text-align: center;
            padding: 1rem;
            background: white;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: auto;
            box-shadow: var(--shadow-sm);
        }

        /* Config section styles - COMPACT VERSION */
        .config-section {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: 1.25rem;
            box-shadow: var(--shadow-lg);
            margin: 0.75rem auto;
            max-width: var(--content-max-width);
            display: none;
            padding-top: 0.5rem;
            margin-top: 0.5rem;
            position: relative;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        /* Tab content transitions */
        .tab-content {
            opacity: 1;
            transform: translateY(0);
        }

        .tab-content[style*="display: none"] {
            opacity: 0;
            transform: translateY(-10px);
        }

        /* Writing workspace transitions */
        .writing-workspace {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .writing-workspace[style*="display: none"] {
            opacity: 0;
            transform: translateY(-10px);
        }

        .form-group {
            margin-bottom: 0px !important;
        }

        .config-section h2 {
            color: var(--primary-color);
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
            font-weight: 700;
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        .config-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .config-card {
            flex: 1;
            min-width: 220px;
            background: white;
            border-radius: 16px;
            padding: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.06);
        }

        .config-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .config-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: currentColor;
        }

        .config-card:hover::before {
            opacity: 1;
        }

        .config-card h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-color);
        }

        .config-card h3 svg {
            width: 18px;
            height: 18px;
            stroke-width: 2;
        }

        .form-group {
            margin-bottom: 0.75rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 500;
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.65rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: white;
            color: var(--text-color);
        }

        .form-control:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
            outline: none;
        }

        /* Center align input placeholder and text */
        input.form-control {
            text-align: center;
        }
        
        input.form-control::placeholder {
            text-align: center;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .difficulty-selection {
            position: relative;
            width: 100%;
            margin: 1rem 0;
            z-index: 9999;
        }

        .difficulty-dropdown {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: white;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 9999;
        }

        .difficulty-dropdown::after {
            content: '▼';
            font-size: 0.8em;
            color: var(--text-secondary);
            position: absolute;  /* Position the arrow */
            right: 1rem;        /* Move to the right */
        }

        .selected-level {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;  /* Center the content */
            flex: 1;
        }

        /* Style for language selector to match difficulty dropdown */
        select.form-control {
            appearance: none;  /* Remove default arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
            padding-right: 2.5rem;  /* Space for the arrow */
            text-align: center;  /* Center the text */
            text-align-last: center;  /* Center the selected option */
            padding-left: 2.5rem;  /* Balance the padding for center alignment */
        }

        /* Center align dropdown options */
        select.form-control option {
            text-align: center;
        }

        /* Remove default arrow in IE */
        select.form-control::-ms-expand {
            display: none;
        }

        /* Ensure the text remains centered when dropdown is open */
        select.form-control:focus {
            text-align: center;
            text-align-last: center;
            border-color: var(--success-color);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        /* Add custom styles for Firefox */
        @-moz-document url-prefix() {
            select.form-control {
                text-align: center;
                text-align-last: center;
            }
            select.form-control option {
                text-align: center;
            }
        }

        .difficulty-cards {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            margin-top: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .difficulty-selection.open .difficulty-cards {
            display: block;
        }

        .difficulty-card {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--border-color);
        }

        .difficulty-card:last-child {
            border-bottom: none;
        }

        .difficulty-card:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        .difficulty-card.selected {
            background: rgba(99, 102, 241, 0.1);
        }

        .difficulty-card .level-icon {
            font-size: 1.5rem;
            margin-right: 0.75rem;
            color: var(--primary-color);
        }

        .difficulty-card .level-name {
            font-weight: 500;
            color: var(--text-color);
            flex: 1;
        }

        .difficulty-card .level-indicator {
            display: flex;
            gap: 3px;
            margin-left: auto;
        }

        .level-indicator span {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--border-color);
        }

        .difficulty-card[data-level="1"] .level-indicator span:nth-child(1) {
            background: var(--primary-color);
        }

        .difficulty-card[data-level="2"] .level-indicator span:nth-child(-n+2) {
            background: var(--primary-color);
        }

        .difficulty-card[data-level="3"] .level-indicator span:nth-child(-n+3) {
            background: var(--primary-color);
        }

        .difficulty-card[data-level="4"] .level-indicator span:nth-child(-n+4) {
            background: var(--primary-color);
        }

        .difficulty-card[data-level="5"] .level-indicator span {
            background: var(--primary-color);
        }

        /* Remove old difficulty slider styles */
        .difficulty-slider, .difficulty-labels {
            display: none;
        }

        .topic-list {
            margin-bottom: 1rem;
        }

        .submit-row {
            display: flex;
            justify-content: center;
            margin-top: 0.75rem;
        }

        .submit-btn {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%) !important;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 14px;
            font-weight: 600;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 20px rgba(67, 233, 123, 0.3);
            position: relative;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover {
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 8px 25px rgba(67, 233, 123, 0.4);
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:active {
            transform: translateY(-1px) scale(1.01);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 3px 12px rgba(67, 233, 123, 0.2);
        }

        .submit-btn svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            stroke-width: 2;
        }

        /* Writing workspace styles */
        .writing-workspace {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            margin: 2rem auto;
            width: 100%;
            max-width: 100%;
            display: none;
            padding-top: 10px;
            margin-top: 10px;
        }

        .workspace-header {
            margin-bottom: 0;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .workspace-title-container {
            display: flex;
            flex-direction: column;
        }

        .workspace-header h2 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .workspace-meta {
            color: var(--text-secondary);
            font-size: 0.9rem;
            background-color: var(--bg-light);
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
        }

        .progress-container {
            margin: 1rem 0;
        }

        .progress-bar {
            height: 10px;
            background: var(--bg-light);
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 999px;
            transition: width 0.5s ease;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* New layout structure with better adaptability */
        .workspace-main {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
            margin-top: 0.75rem;
            width: 100%;
            min-height: 665px;
        }

        .workspace-main.expanded {
            min-height: 820px; /* More space when expanded */
        }

        .workspace-content {
            position: relative;
            padding-bottom: 85px;
            height: 665px;
        }

        .workspace-content.expanded {
            height: auto;
            min-height: 800px;
        }

        /* Content panel with improved flexibility */
        .content-panel {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 1px solid var(--border-color);
            height: auto;
            min-height: 91%;
            display: flex;
            flex-direction: column;
        }

        /* Right panel with feedback should expand as needed */
        .content-panel.feedback-container {
            height: auto;
            min-height: 665px;
            max-height: calc(100vh - 110px);
        }

        .panel-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 0.85rem 1.2rem;
            font-weight: 600;
            font-size: 1.05rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .practice-timer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            color: white;
            font-weight: 500;
            font-size: 0.9rem;
            margin-left: 1rem;
            backdrop-filter: blur(4px);
        }

        .practice-timer i {
            color: white;
            opacity: 0.9;
        }

        #timer-display {
            min-width: 60px;
            text-align: center;
            font-family: monospace;
            color: white;
            font-size: 1rem;
            letter-spacing: 1px;
        }

        /* Ensure timer is visible when display: flex is set */
        #practice-timer[style*="display: flex"] {
            display: flex !important;
        }

        .panel-content {
            padding: 0.85rem;
            height: calc(100% - 60px);
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            width: 100%;
        }

        /* Expand when there's a lot of content */
        .panel-content.expanded {
            height: auto;
            min-height: calc(100% - 60px);
            max-height: none;
        }

        /* Vietnamese panel */
        .vietnamese-panel {
            min-height: 400px;
            max-height: 538px;
        }

        .vietnamese-text {
            margin-bottom: 1rem;
        }

        .vietnamese-sentence {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: var(--border-radius-sm);
            border-left: 4px solid #ddd;
            transition: var(--transition);
            background-color: var(--bg-light);
        }

        .vietnamese-sentence.active {
            border-left-color: var(--primary-color);
            background-color: rgba(79, 70, 229, 0.1);
            box-shadow: var(--shadow-sm);
        }

        .vietnamese-sentence.completed {
            border-left-color: var(--success-color);
        }

        /* Translation panel */
        .translation-panel {
            min-height: 200px;
            max-height: 200px;
            background: transparent;
            border: none;
        }

        .translation-panel .panel-content {
            padding: 0;
            height: auto;
        }

        .translation-area p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
        }

        .translation-input-container {
            margin-bottom: 0.5rem;
            position: relative;
        }

        .translation-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 0.35rem;
            padding: 8px 0;
        }

        .translation-input {
            width: 100%;
            padding: 0.85rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1.125rem;
            resize: vertical;
            min-height: 80px;
            max-height: 90px;
            transition: var(--transition);
            background: white;
        }

        .translation-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }

        /* Speech-to-Text Button Styles */
        .speech-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: #6b7280;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
            padding: 0;
        }

        .speech-btn:hover {
            background: #4b5563;
            transform: scale(1.05);
        }

        .speech-btn.listening {
            background: #dc2626;
            animation: pulse-listening 1.5s infinite;
        }

        .speech-btn.processing {
            background: #2563eb;
        }

        .speech-btn.error {
            background: #dc2626;
        }

        .speech-btn.disabled {
            background: #d1d5db;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .speech-btn .mic-icon {
            transition: all 0.2s ease;
        }

        .speech-btn.listening .mic-icon {
            animation: mic-bounce 0.6s ease-in-out infinite alternate;
        }

        .recording-pulse {
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #dc2626;
            border-radius: 50%;
            opacity: 0;
            animation: pulse-ring 1.5s infinite;
        }

        .speech-btn.listening .recording-pulse {
            opacity: 1;
        }

        /* Speech Status */
        .speech-status {
            position: absolute;
            top: 50px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 15;
        }

        .speech-status.listening {
            background: rgba(220, 38, 38, 0.9);
        }

        .speech-status.processing {
            background: rgba(37, 99, 235, 0.9);
        }

        .speech-status.error {
            background: rgba(220, 38, 38, 0.9);
        }

        /* Animations */
        @keyframes pulse-listening {
            0% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(220, 38, 38, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0);
            }
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }
            100% {
                transform: scale(1.2);
                opacity: 0;
            }
        }

        @keyframes mic-bounce {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-2px);
            }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .speech-btn {
                width: 32px;
                height: 32px;
                top: 8px;
                right: 8px;
            }

            .speech-btn .mic-icon {
                width: 16px;
                height: 16px;
            }

            .speech-status {
                top: 45px;
                right: 8px;
                font-size: 11px;
            }
        }

        .countdown-timer {
            display: none !important;
        }

        /* Hint button styles */
        .hint-btn {
            background-color: var(--warning-color);
            color: white;
            opacity: 0.5;
            cursor: not-allowed;
            min-width: 120px; /* Ensure button doesn't jump when text changes */
        }

        .hint-btn.enabled {
            opacity: 1;
            cursor: pointer;
        }

        .hint-btn.enabled:hover {
            background-color: var(--warning-light);
        }

        /* Hint popup styles */
        .hint-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            max-width: 600px;
            width: 90%;
            z-index: 1000;
        }

        .hint-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .hint-popup-header h3 {
            color: var(--primary-color);
            font-size: 1.25rem;
            margin: 0;
        }

        .hint-popup-header h3 .cached-indicator {
            font-size: 0.85rem;
            background-color: #e5e7eb;
            color: #4b5563;
            padding: 0.2rem 0.5rem;
            border-radius: 999px;
            margin-left: 0.5rem;
            vertical-align: middle;
        }

        .hint-popup-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem;
        }

        .hint-popup-close:hover {
            color: var(--text-color);
        }

        .hint-popup-content {
            margin-bottom: 1.5rem;
        }

        .hint-section {
            margin-bottom: 1.5rem;
        }

        .hint-section:last-child {
            margin-bottom: 0;
        }

        .hint-section h4 {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .vocabulary-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .vocabulary-item {
            background: var(--bg-light);
            padding: 0.75rem;
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
        }

        .vocabulary-item strong {
            color: var(--primary-color);
            display: block;
            margin-bottom: 0.25rem;
        }

        .sentence-structure {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
        }

        .hint-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 999;
        }

        /* Feedback panel optimized styles */
        .feedback-panel {
            background-color: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            margin-top: 0.75rem;
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            transition: all 0.3s ease;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transform: translateY(-10px);
            border: 1px solid var(--border-color);
        }

        .feedback-panel.visible {
            max-height: calc(100vh - 170px);
            overflow-y: auto;
            opacity: 1;
            transform: translateY(0);
        }

        .feedback-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.8rem;
            position: relative;
        }

        .feedback-result {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feedback-result.success {
            color: var(--success-color);
        }

        .feedback-result.success::before {
            content: "✓";
            margin-right: 5px;
        }

        .feedback-result.error {
            color: var(--accent-color);
        }

        .feedback-result.error::before {
            content: "✗";
            margin-right: 5px;
        }

        .feedback-score {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary-color);
            padding: 0.25rem 0.75rem;
            background: rgba(79, 70, 229, 0.1);
            border-radius: 20px;
        }

        .feedback-body {
            color: var(--text-secondary);
        }

        .feedback-section {
            margin-bottom: 1rem;
            padding: 1rem;
            padding-bottom: 1px;
            background-color: var(--bg-light);
            border-radius: var(--border-radius-sm);
            border-left: 4px solid var(--primary-color);
        }

        .feedback-section h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.4rem;
            color: var(--text-color);
            display: flex;
            align-items: center;
        }

        .feedback-section h4 svg {
            margin-right: 0.5rem;
            color: var(--primary-color);
        }

        #generalFeedback, #highlightedSuggestion {
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        .improvements-list {
            margin: 0.2rem 0;
            padding-left: 1.5rem;
            list-style-type: none;
        }

        .improvements-list li {
            font-size: 0.9rem;
            margin-bottom: 0.4rem;
            padding: 5px 8px;
            padding-left: 16px;
            line-height: 1.35;
            color: #F57F17;
            position: relative;
        }

        .improvements-list li::before {
            content: "•";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            color: #F57F17;
            font-weight: bold;
            font-size: 1.1rem;
            line-height: 1;
        }

        .highlight {
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-weight: 600;
            color: #D32F2F;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: inline-block;
            margin: 0 2px;
            position: relative;
            text-decoration: underline wavy #D32F2F;
            letter-spacing: 0.02em;
            animation: highlight-pulse 2s infinite;
        }

        @keyframes highlight-pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        /* Previous translations */
        .previous-translations {
            margin-top: 1.5rem;
        }

        .previous-translations h4 {
            color: var(--primary-color);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .previous-translation-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-radius: var(--border-radius-sm);
            background-color: var(--bg-light);
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }

        .previous-translation-item strong {
            color: var(--primary-color);
        }

        .previous-translation-item:last-child {
            margin-bottom: 0;
        }

        /* Completion summary */
        .completion-summary {
            background-color: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            margin-top: 2rem;
            display: none;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .summary-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .summary-header h2 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .overall-score {
            font-size: 3rem;
            font-weight: 700;
            color: var(--success-color);
            display: block;
            text-align: center;
            margin: 1rem 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .summary-sections {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .summary-section {
            background-color: var(--bg-light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .summary-section h3 {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
        }

        .summary-section h3 svg {
            color: var(--primary-color);
        }

        .summary-list {
            list-style-type: none;
        }

        .summary-list li {
            margin-bottom: 0.75rem;
            padding: 0.5rem 0.75rem 0.5rem 1.5rem;
            position: relative;
            background-color: white;
            border-radius: 6px;
            font-size: 0.95rem;
        }

        .summary-list li:before {
            content: '•';
            position: absolute;
            left: 0.5rem;
            color: var(--primary-color);
        }

        .summary-actions {
            text-align: center;
            margin-top: 2rem;
        }

        /* Keyboard shortcuts panel */
        .keyboard-shortcuts {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--shadow-md);
            font-size: 0.9rem;
            z-index: 100;
            display: none;
            border: 1px solid var(--border-color);
        }

        .keyboard-shortcuts.visible {
            display: block;
        }

        .keyboard-shortcuts h4 {
            margin-bottom: 0.75rem;
            color: var(--primary-color);
        }

        .shortcut-list {
            list-style-type: none;
        }

        .shortcut-list li {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }

        .shortcut-key {
            background-color: var(--primary-color);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            margin-right: 0.5rem;
            font-family: monospace;
            font-weight: 600;
        }

        /* Mobile warning styles */
        html.mobile-warning-shown,
        html.mobile-warning-shown body {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .mobile-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.9);
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            touch-action: none;
            -webkit-overflow-scrolling: none;
        }

        .mobile-warning-content {
            position: relative;
            width: min(90%, 300px);
            height: min(85vh, 600px);
            background: #ffffff;
            border-radius: 24px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideUpFade 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            overflow: hidden;
        }

        .mobile-warning-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            width: 100%;
            padding: 0.5rem;
            overflow: hidden;
        }

        .mobile-warning-illustration {
            width: 80px;
            height: 80px;
            flex-shrink: 0;
            border-radius: 40px;
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 12px 24px -8px rgba(99, 102, 241, 0.5);
            margin: 0 auto 0.5rem;
        }

        .mobile-warning-text {
            color: #1f2937;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
        }

        .mobile-warning h2 {
            font-size: 1.125rem;
            font-weight: 700;
            line-height: 1.3;
            background: linear-gradient(135deg, #4f46e5, #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
            padding: 0;
        }

        .mobile-warning p {
            font-size: 0.875rem;
            line-height: 1.5;
            color: #4b5563;
            margin: 0;
            padding: 0;
        }

        .mobile-warning-actions {
            width: 100%;
            padding: 0.75rem 0 0;
            flex-shrink: 0;
        }

        .mobile-warning .btn-primary {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            padding: 0.75rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            border: none;
            width: 100%;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25);
            white-space: nowrap;
        }

        .mobile-warning .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(79, 70, 229, 0.3);
        }

        .mobile-warning .btn-primary:active {
            transform: translateY(0);
        }

        .mobile-warning .btn-primary svg {
            width: 14px;
            height: 14px;
            stroke-width: 2;
            flex-shrink: 0;
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile warning responsive adjustments */
        @media (max-width: 380px) {
            .mobile-warning-content {
                width: min(100%, 276px);
                height: min(90vh, 335px);
                padding: 1rem;
            }

            .mobile-warning-main {
                gap: 1rem;
            }

            .mobile-warning-illustration {
                width: 64px;
                height: 64px;
                border-radius: 32px;
            }

            .mobile-warning-text {
                gap: 0.75rem;
            }

            .mobile-warning h2 {
                font-size: 1rem;
            }

            .mobile-warning p {
                font-size: 0.8125rem;
            }

            .mobile-warning-actions {
                padding: 0.5rem 0 0;
            }

            .mobile-warning .btn-primary {
                padding: 0.625rem;
                font-size: 0.8125rem;
            }

            .mobile-warning .btn-primary svg {
                width: 12px;
                height: 12px;
            }
        }

        /* Loading overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1001;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
            backdrop-filter: blur(5px);
            padding: 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 2rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.2rem;
            font-weight: 500;
            text-align: center;
            max-width: 80%;
            line-height: 1.5;
            margin: 0 auto;
        }

        #loadingMessage {
            display: inline-block;
            text-align: center;
            width: 100%;
            max-width: 600px;
        }

        #loadingMessage span {
            display: inline;
            white-space: normal;
            word-wrap: break-word;
        }

        /* Loading container to ensure proper centering */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Updated panel styles */
        .paragraph-panel {
            min-height: 230px;
            max-height: 430px;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            display: flex;
            flex-direction: column;
        }

        .paragraph-panel .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 0.5rem;
            padding-top: 8px;
            padding-bottom: 16px;
            scroll-behavior: smooth;
        }

        .paragraph-text {
            font-size: 1.05rem;
            line-height: 1.7;
            color: var(--text-color);
            padding: 0.25rem;
            padding-bottom: 28px;
        }

        /* Sentence styles */
        .sentence {
            display: inline;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            font-size: 15px;
        }

        .sentence.current {
            background-color: var(--current-sentence-bg);
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(99, 102, 241, 0.2);
            scroll-margin: 1rem;
        }

        /* Custom scrollbar for paragraph panel */
        .paragraph-panel .panel-content::-webkit-scrollbar {
            width: 8px;
        }

        .paragraph-panel .panel-content::-webkit-scrollbar-track {
            background: var(--bg-light);
            border-radius: 4px;
        }

        .paragraph-panel .panel-content::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 4px;
            border: 2px solid var(--bg-light);
        }

        .paragraph-panel .panel-content::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* Fade effect for long content */
        .paragraph-panel .panel-content::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(to top, var(--bg-card), transparent);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .paragraph-panel .panel-content.has-overflow::after {
            opacity: 1;
        }

        .config-card h3 {
            font-size: 19px;
        }

        .translation-section {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            z-index: 5;
            padding: 12px;
            border-top: 1px solid var(--border-color);
        }

        /* Giảm kích thước nút để vừa vặn và gọn gàng hơn */
        .btn.warning, .hint-btn {
            padding: 0px 18px;
            font-size: 0.95rem;
            min-height: 49px;
            min-width: 120px;
        }

        .btn.primary {
            padding: 14px 24px;
            font-size: 0.95rem;
            min-height: 38px;
            min-width: 120px;
        }

        /* Điều chỉnh lại content container */
        .content-panel {
            height: auto;
            min-height: 91%;
            display: flex;
            flex-direction: column;
        }

        /* Điều chỉnh paragrah text */
        .paragraph-text {
            font-size: 1.05rem;
            line-height: 1.7;
            padding: 0.25rem;
            padding-bottom: 28px;
        }

        /* Điều chỉnh feedback content */
        .feedback-content {
            padding: 0.75rem;
        }

        /* Giảm khoảng cách của feedback panel */
        #generalFeedbackSection {
            margin-bottom: 1rem;
            padding: 1rem;
        }

        /* Responsive adjustments */
        @media (max-height: 800px) {
            .workspace-main {
                min-height: 650px;
            }
            
            .workspace-content {
                height: 650px;
            }
            
            .paragraph-panel {
                min-height: 200px;
                max-height: 400px;
            }
            
            .feedback-panel.visible {
                max-height: calc(100vh - 200px);
            }
        }

        /* Fix scrolling issues */
        html, body {
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        /* Chỉnh nút phím tắt nhỏ gọn hơn */
        #showShortcutsBtn {
            padding: 5px 12px;
            font-size: 0.85rem;
            height: 34px;
        }

        #suggestedSection {
            display: none; /* Hide by default */
            border-left-color: #D32F2F;
            background-color: #FFEBEE;
            margin-bottom: 1rem;
            padding: 1rem;
        }

        #suggestedSection.visible {
            display: block;
        }

        #suggestedSection h4 {
            color: #D32F2F;
            margin-bottom: 0.4rem;
        }

        #suggestedSection h4 svg {
            color: #D32F2F;
        }

        #highlightedSuggestion {
            line-height: 1.8;
            padding: 12px;
            border-radius: 6px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            font-size: 0.95rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Make selectors more specific and add !important for critical styles */
        #suggestedSection #highlightedSuggestion strong,
        #suggestedSection #highlightedSuggestion .highlight {
            color: #D32F2F !important;
            font-weight: 600 !important;
            padding: 0 2px;
            display: inline-block;
            animation: highlight-glow 2s ease-in-out infinite;
        }

        @keyframes highlight-glow {
            0% { text-shadow: 0 0 2px rgba(211, 47, 47, 0.2); }
            50% { text-shadow: 0 0 8px rgba(211, 47, 47, 0.4); }
            100% { text-shadow: 0 0 2px rgba(211, 47, 47, 0.2); }
        }

        /* Ensure the section is visible when needed */
        #suggestedSection.visible {
            display: block !important;
        }

        /* Language select styles */
        .language-select {
            padding-left: 40px !important; /* Space for flag */
            position: relative;
            background-position: 10px center;
            background-repeat: no-repeat;
            background-size: 20px auto;
        }

        .language-select option {
            padding-left: 40px;
            height: 30px;
            display: flex;
            align-items: center;
        }

        .flag-svg {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            vertical-align: middle;
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        /* Custom select with flags */
        .language-select-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .language-select-container::before {
            content: "";
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            pointer-events: none;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .modal-content.info {
            border-top: 4px solid #2196F3;
        }

        .modal-content.info .modal-icon svg {
            stroke: #2196F3;
        }

        .practice-timer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            color: var(--primary-color);
            font-weight: 500;
            font-size: 1rem;
        }

        .practice-timer i {
            color: var(--primary-color);
        }

        #timer-display {
            min-width: 60px;
            text-align: center;
            font-family: monospace;
        }

        .workspace-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .content-type-selection {
            margin-top: 10px;
        }
        
        .content-type-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .content-type-option {
            display: block;
            cursor: pointer;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            transition: all 0.2s ease;
        }
        
        .content-type-option:hover {
            background-color: #f5f5f5;
            transform: translateY(-2px);
        }
        
        .content-type-option input {
            position: absolute;
            opacity: 0;
        }
        
        .content-type-option input:checked + .option-content {
            color: #2196F3;
        }
        
        .content-type-option input:checked + .option-content .option-icon {
            color: #2196F3;
        }
        
        .content-type-option input:checked ~ .content-type-option {
            border-color: #2196F3;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
        }
        
        .option-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .option-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: #f5f5f5;
            border-radius: 50%;
            margin-bottom: 5px;
            color: #666;
        }
        
        .option-label {
            font-weight: 600;
            font-size: 16px;
        }
        
        .option-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Compact Extension Banner - Indigo Theme */
        .extension-highlight {
            background: linear-gradient(135deg, rgba(92, 107, 192, 0.08), rgba(121, 134, 203, 0.08));
            border: 2px solid rgba(92, 107, 192, 0.2);
            border-radius: 14px;
            padding: 0.6rem 0.8rem;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .extension-highlight:hover {
            transform: translateY(-1px);
            background: linear-gradient(135deg, rgba(92, 107, 192, 0.12), rgba(121, 134, 203, 0.12));
            border-color: rgba(92, 107, 192, 0.4);
            box-shadow: 0 6px 20px rgba(92, 107, 192, 0.15);
        }

        .extension-icon {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #5c6bc0, #7986cb);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        .extension-highlight:hover .extension-icon {
            transform: scale(1.05) rotate(3deg);
        }

        .extension-icon svg {
            width: 14px;
            height: 14px;
            stroke: white;
            stroke-width: 2.5;
        }

        .extension-text {
            font-size: 0.8rem;
            color: #5c6bc0;
            line-height: 1.3;
            font-weight: 500;
            flex: 1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            width: 100%;
            max-width: var(--container-width);
            margin: 0 auto;
            padding: 0 var(--container-padding);
            flex: 1;
        }

        header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem var(--container-padding);
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .logo {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
        }

        .btn.primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
        }

        .btn.primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(99, 102, 241, 0.1), 0 2px 4px -1px rgba(99, 102, 241, 0.06);
        }

        .btn.secondary {
            background: white;
            color: var(--primary-color);
            border: 2px solid var(--primary-light);
        }

        .btn.secondary:hover {
            background: var(--primary-light);
            color: white;
            border-color: var(--primary-color);
        }

        .btn.info {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
        }

        .btn.info:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(33, 150, 243, 0.1), 0 2px 4px -1px rgba(33, 150, 243, 0.06);
        }

        .btn.warning {
            background: linear-gradient(135deg, var(--warning-color), var(--warning-light));
            color: white;
        }

        .btn.warning:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(245, 158, 11, 0.1), 0 2px 4px -1px rgba(245, 158, 11, 0.06);
        }

        .btn.success {
            background: var(--success-color);
            color: white;
        }

        .btn.success:hover {
            background: var(--success-light);
        }

        .btn svg {
            color: currentColor;
        }

        .footer {
            text-align: center;
            padding: 1rem;
            background: white;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: auto;
            box-shadow: var(--shadow-sm);
        }

        /* Config section styles - COMPACT VERSION */
        .config-section {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: 1.25rem;
            box-shadow: var(--shadow-lg);
            margin: 0.75rem auto;
            max-width: var(--content-max-width);
            display: none;
            padding-top: 0.5rem;
            margin-top: 0.5rem;
            position: relative;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        /* Tab content transitions */
        .tab-content {
            opacity: 1;
            transform: translateY(0);
        }

        .tab-content[style*="display: none"] {
            opacity: 0;
            transform: translateY(-10px);
        }

        /* Writing workspace transitions */
        .writing-workspace {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .writing-workspace[style*="display: none"] {
            opacity: 0;
            transform: translateY(-10px);
        }

        .config-section h2 {
            color: var(--primary-color);
            font-size: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
            font-weight: 700;
            background: var(--secondary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

        .config-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .config-card {
            flex: 1;
            min-width: 220px;
            background: white;
            border-radius: 16px;
            padding: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            box-shadow: 0 3px 15px rgba(0, 0, 0, 0.06);
        }

        .config-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .config-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: currentColor;
        }

        .config-card:hover::before {
            opacity: 1;
        }

        .config-card h3 {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-color);
        }

        .config-card h3 svg {
            width: 18px;
            height: 18px;
            stroke-width: 2;
        }

        .form-group {
            margin-bottom: 0.75rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 500;
            color: var(--text-color);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.65rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            transition: all 0.3s ease;
            background: white;
            color: var(--text-color);
        }

        .form-control:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 4px rgba(14, 165, 233, 0.1);
            outline: none;
        }

        /* Center align input placeholder and text */
        input.form-control {
            text-align: center;
        }
        
        input.form-control::placeholder {
            text-align: center;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .difficulty-selection {
            position: relative;
            width: 100%;
            margin: 1rem 0;
            z-index: 9999;
        }

        .difficulty-dropdown {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: white;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 9999;
        }

        .difficulty-dropdown::after {
            content: '▼';
            font-size: 0.8em;
            color: var(--text-secondary);
            position: absolute;  /* Position the arrow */
            right: 1rem;        /* Move to the right */
        }

        .selected-level {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;  /* Center the content */
            flex: 1;
        }

        /* Style for language selector to match difficulty dropdown */
        select.form-control {
            appearance: none;  /* Remove default arrow */
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1em;
            padding-right: 2.5rem;  /* Space for the arrow */
            text-align: center;  /* Center the text */
            text-align-last: center;  /* Center the selected option */
            padding-left: 2.5rem;  /* Balance the padding for center alignment */
        }

        /* Center align dropdown options */
        select.form-control option {
            text-align: center;
        }

        /* Remove default arrow in IE */
        select.form-control::-ms-expand {
            display: none;
        }

        /* Ensure the text remains centered when dropdown is open */
        select.form-control:focus {
            text-align: center;
            text-align-last: center;
            border-color: var(--success-color);
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        /* Add custom styles for Firefox */
        @-moz-document url-prefix() {
            select.form-control {
                text-align: center;
                text-align-last: center;
            }
            select.form-control option {
                text-align: center;
            }
        }

        .difficulty-cards {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 10000;
            margin-top: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .difficulty-selection.open .difficulty-cards {
            display: block;
        }

        .difficulty-card {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid var(--border-color);
        }

        .difficulty-card:last-child {
            border-bottom: none;
        }

        .difficulty-card:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        .difficulty-card.selected {
            background: rgba(99, 102, 241, 0.1);
        }

        .difficulty-card .level-icon {
            font-size: 1.5rem;
            margin-right: 0.75rem;
            color: var(--primary-color);
        }

        .difficulty-card .level-name {
            font-weight: 500;
            color: var(--text-color);
            flex: 1;
        }

        .difficulty-card .level-indicator {
            display: flex;
            gap: 3px;
            margin-left: auto;
        }

        .level-indicator span {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--border-color);
        }

        .difficulty-card[data-level="1"] .level-indicator span:nth-child(1) {
            background: var(--primary-color);
        }

        .difficulty-card[data-level="2"] .level-indicator span:nth-child(-n+2) {
            background: var(--primary-color);
        }

        .difficulty-card[data-level="3"] .level-indicator span:nth-child(-n+3) {
            background: var(--primary-color);
        }

        .difficulty-card[data-level="4"] .level-indicator span:nth-child(-n+4) {
            background: var(--primary-color);
        }

        .difficulty-card[data-level="5"] .level-indicator span {
            background: var(--primary-color);
        }

        /* Remove old difficulty slider styles */
        .difficulty-slider, .difficulty-labels {
            display: none;
        }

        .topic-list {
            margin-bottom: 1rem;
        }

        .submit-row {
            display: flex;
            justify-content: center;
            margin-top: 0.75rem;
        }

        .submit-btn {
            background: linear-gradient(135deg, #66bb6a 0%, #4caf50 100%) !important;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 14px;
            font-weight: 600;
            font-size: 1rem;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 6px 20px rgba(67, 233, 123, 0.3);
            position: relative;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .submit-btn:hover {
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 8px 25px rgba(67, 233, 123, 0.4);
        }

        .submit-btn:hover::before {
            left: 100%;
        }

        .submit-btn:active {
            transform: translateY(-1px) scale(1.01);
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 3px 12px rgba(67, 233, 123, 0.2);
        }

        .submit-btn svg {
            width: 18px;
            height: 18px;
            stroke: currentColor;
            stroke-width: 2;
        }

        /* Writing workspace styles */
        .writing-workspace {
            background: var(--bg-card);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            margin: 2rem auto;
            width: 100%;
            max-width: 100%;
            display: none;
            padding-top: 10px;
            margin-top: 10px;
        }

        .workspace-header {
            margin-bottom: 0;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .workspace-title-container {
            display: flex;
            flex-direction: column;
        }

        .workspace-header h2 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .workspace-meta {
            color: var(--text-secondary);
            font-size: 0.9rem;
            background-color: var(--bg-light);
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
        }

        .progress-container {
            margin: 1rem 0;
        }

        .progress-bar {
            height: 10px;
            background: var(--bg-light);
            border-radius: 999px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: 999px;
            transition: width 0.5s ease;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }

        /* New layout structure with better adaptability */
        .workspace-main {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
            margin-top: 0.75rem;
            width: 100%;
            min-height: 665px;
        }

        .workspace-main.expanded {
            min-height: 820px; /* More space when expanded */
        }

        .workspace-content {
            position: relative;
            padding-bottom: 85px;
            height: 665px;
        }

        .workspace-content.expanded {
            height: auto;
            min-height: 800px;
        }

        /* Content panel with improved flexibility */
        .content-panel {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            overflow: hidden;
            border: 1px solid var(--border-color);
            height: auto;
            min-height: 91%;
            display: flex;
            flex-direction: column;
        }

        /* Right panel with feedback should expand as needed */
        .content-panel.feedback-container {
            height: auto;
            min-height: 665px;
            max-height: calc(100vh - 110px);
        }

        .panel-header {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 0.85rem 1.2rem;
            font-weight: 600;
            font-size: 1.05rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .practice-timer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            color: white;
            font-weight: 500;
            font-size: 0.9rem;
            margin-left: 1rem;
            backdrop-filter: blur(4px);
        }

        .practice-timer i {
            color: white;
            opacity: 0.9;
        }

        #timer-display {
            min-width: 60px;
            text-align: center;
            font-family: monospace;
            color: white;
            font-size: 1rem;
            letter-spacing: 1px;
        }

        /* Ensure timer is visible when display: flex is set */
        #practice-timer[style*="display: flex"] {
            display: flex !important;
        }

        .panel-content {
            padding: 0.85rem;
            height: calc(100% - 60px);
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            width: 100%;
        }

        /* Expand when there's a lot of content */
        .panel-content.expanded {
            height: auto;
            min-height: calc(100% - 60px);
            max-height: none;
        }

        /* Vietnamese panel */
        .vietnamese-panel {
            min-height: 400px;
            max-height: 538px;
        }

        .vietnamese-text {
            margin-bottom: 1rem;
        }

        .vietnamese-sentence {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: var(--border-radius-sm);
            border-left: 4px solid #ddd;
            transition: var(--transition);
            background-color: var(--bg-light);
        }

        .vietnamese-sentence.active {
            border-left-color: var(--primary-color);
            background-color: rgba(79, 70, 229, 0.1);
            box-shadow: var(--shadow-sm);
        }

        .vietnamese-sentence.completed {
            border-left-color: var(--success-color);
        }

        /* Translation panel */
        .translation-panel {
            min-height: 200px;
            max-height: 200px;
            background: transparent;
            border: none;
        }

        .translation-panel .panel-content {
            padding: 0;
            height: auto;
        }

        .translation-area p {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 0.75rem;
        }

        .translation-input-container {
            margin-bottom: 0.5rem;
            position: relative;
        }

        .translation-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 0.35rem;
            padding: 8px 0;
        }

        .translation-input {
            width: 100%;
            padding: 0.85rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1.125rem;
            resize: vertical;
            min-height: 80px;
            max-height: 90px;
            transition: var(--transition);
            background: white;
        }

        .translation-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }

        /* Speech-to-Text Button Styles */
        .speech-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 50%;
            background: #6b7280;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
            padding: 0;
        }

        .speech-btn:hover {
            background: #4b5563;
            transform: scale(1.05);
        }

        .speech-btn.listening {
            background: #dc2626;
            animation: pulse-listening 1.5s infinite;
        }

        .speech-btn.processing {
            background: #2563eb;
        }

        .speech-btn.error {
            background: #dc2626;
        }

        .speech-btn.disabled {
            background: #d1d5db;
            cursor: not-allowed;
            opacity: 0.5;
        }

        .speech-btn .mic-icon {
            transition: all 0.2s ease;
        }

        .speech-btn.listening .mic-icon {
            animation: mic-bounce 0.6s ease-in-out infinite alternate;
        }

        .recording-pulse {
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid #dc2626;
            border-radius: 50%;
            opacity: 0;
            animation: pulse-ring 1.5s infinite;
        }

        .speech-btn.listening .recording-pulse {
            opacity: 1;
        }

        /* Speech Status */
        .speech-status {
            position: absolute;
            top: 50px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 15;
        }

        .speech-status.listening {
            background: rgba(220, 38, 38, 0.9);
        }

        .speech-status.processing {
            background: rgba(37, 99, 235, 0.9);
        }

        .speech-status.error {
            background: rgba(220, 38, 38, 0.9);
        }

        /* Animations */
        @keyframes pulse-listening {
            0% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(220, 38, 38, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(220, 38, 38, 0);
            }
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 1;
            }
            100% {
                transform: scale(1.2);
                opacity: 0;
            }
        }

        @keyframes mic-bounce {
            0% {
                transform: translateY(0);
            }
            100% {
                transform: translateY(-2px);
            }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .speech-btn {
                width: 32px;
                height: 32px;
                top: 8px;
                right: 8px;
            }

            .speech-btn .mic-icon {
                width: 16px;
                height: 16px;
            }

            .speech-status {
                top: 45px;
                right: 8px;
                font-size: 11px;
            }
        }

        .countdown-timer {
            display: none !important;
        }

        /* Hint button styles */
        .hint-btn {
            background-color: var(--warning-color);
            color: white;
            opacity: 0.5;
            cursor: not-allowed;
            min-width: 120px; /* Ensure button doesn't jump when text changes */
        }

        .hint-btn.enabled {
            opacity: 1;
            cursor: pointer;
        }

        .hint-btn.enabled:hover {
            background-color: var(--warning-light);
        }

        /* Hint popup styles */
        .hint-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            max-width: 600px;
            width: 90%;
            z-index: 1000;
        }

        .hint-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .hint-popup-header h3 {
            color: var(--primary-color);
            font-size: 1.25rem;
            margin: 0;
        }

        .hint-popup-header h3 .cached-indicator {
            font-size: 0.85rem;
            background-color: #e5e7eb;
            color: #4b5563;
            padding: 0.2rem 0.5rem;
            border-radius: 999px;
            margin-left: 0.5rem;
            vertical-align: middle;
        }

        .hint-popup-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.5rem;
        }

        .hint-popup-close:hover {
            color: var(--text-color);
        }

        .hint-popup-content {
            margin-bottom: 1.5rem;
        }

        .hint-section {
            margin-bottom: 1.5rem;
        }

        .hint-section:last-child {
            margin-bottom: 0;
        }

        .hint-section h4 {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .vocabulary-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
        }

        .vocabulary-item {
            background: var(--bg-light);
            padding: 0.75rem;
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
        }

        .vocabulary-item strong {
            color: var(--primary-color);
            display: block;
            margin-bottom: 0.25rem;
        }

        .sentence-structure {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
        }

        .hint-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 999;
        }

        /* Feedback panel optimized styles */
        .feedback-panel {
            background-color: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            margin-top: 0.75rem;
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            transition: all 0.3s ease;
            max-height: 0;
            overflow: hidden;
            opacity: 0;
            transform: translateY(-10px);
            border: 1px solid var(--border-color);
        }

        .feedback-panel.visible {
            max-height: calc(100vh - 170px);
            overflow-y: auto;
            opacity: 1;
            transform: translateY(0);
        }

        .feedback-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 0.8rem;
            position: relative;
        }

        .feedback-result {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .feedback-result.success {
            color: var(--success-color);
        }

        .feedback-result.success::before {
            content: "✓";
            margin-right: 5px;
        }

        .feedback-result.error {
            color: var(--accent-color);
        }

        .feedback-result.error::before {
            content: "✗";
            margin-right: 5px;
        }

        .feedback-score {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--primary-color);
            padding: 0.25rem 0.75rem;
            background: rgba(79, 70, 229, 0.1);
            border-radius: 20px;
        }

        .feedback-body {
            color: var(--text-secondary);
        }

        .feedback-section {
            margin-bottom: 1rem;
            padding: 1rem;
            padding-bottom: 1px;
            background-color: var(--bg-light);
            border-radius: var(--border-radius-sm);
            border-left: 4px solid var(--primary-color);
        }

        .feedback-section h4 {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.4rem;
            color: var(--text-color);
            display: flex;
            align-items: center;
        }

        .feedback-section h4 svg {
            margin-right: 0.5rem;
            color: var(--primary-color);
        }

        #generalFeedback, #highlightedSuggestion {
            margin: 0;
            padding: 0;
            line-height: 1.5;
        }

        .improvements-list {
            margin: 0.2rem 0;
            padding-left: 1.5rem;
            list-style-type: none;
        }

        .improvements-list li {
            font-size: 0.9rem;
            margin-bottom: 0.4rem;
            padding: 5px 8px;
            padding-left: 16px;
            line-height: 1.35;
            color: #F57F17;
            position: relative;
        }

        .improvements-list li::before {
            content: "•";
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            color: #F57F17;
            font-weight: bold;
            font-size: 1.1rem;
            line-height: 1;
        }

        .highlight {
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-weight: 600;
            color: #D32F2F;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: inline-block;
            margin: 0 2px;
            position: relative;
            text-decoration: underline wavy #D32F2F;
            letter-spacing: 0.02em;
            animation: highlight-pulse 2s infinite;
        }

        @keyframes highlight-pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        /* Previous translations */
        .previous-translations {
            margin-top: 1.5rem;
        }

        .previous-translations h4 {
            color: var(--primary-color);
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .previous-translation-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-radius: var(--border-radius-sm);
            background-color: var(--bg-light);
            box-shadow: var(--shadow-sm);
            font-size: 0.9rem;
        }

        .previous-translation-item strong {
            color: var(--primary-color);
        }

        .previous-translation-item:last-child {
            margin-bottom: 0;
        }

        /* Completion summary */
        .completion-summary {
            background-color: var(--bg-card);
            border-radius: var(--border-radius);
            padding: 2rem;
            box-shadow: var(--shadow-md);
            margin-top: 2rem;
            display: none;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .summary-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .summary-header h2 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .overall-score {
            font-size: 3rem;
            font-weight: 700;
            color: var(--success-color);
            display: block;
            text-align: center;
            margin: 1rem 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .summary-sections {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .summary-section {
            background-color: var(--bg-light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .summary-section h3 {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--primary-color);
        }

        .summary-section h3 svg {
            color: var(--primary-color);
        }

        .summary-list {
            list-style-type: none;
        }

        .summary-list li {
            margin-bottom: 0.75rem;
            padding: 0.5rem 0.75rem 0.5rem 1.5rem;
            position: relative;
            background-color: white;
            border-radius: 6px;
            font-size: 0.95rem;
        }

        .summary-list li:before {
            content: '•';
            position: absolute;
            left: 0.5rem;
            color: var(--primary-color);
        }

        .summary-actions {
            text-align: center;
            margin-top: 2rem;
        }

        /* Keyboard shortcuts panel */
        .keyboard-shortcuts {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            box-shadow: var(--shadow-md);
            font-size: 0.9rem;
            z-index: 100;
            display: none;
            border: 1px solid var(--border-color);
        }

        .keyboard-shortcuts.visible {
            display: block;
        }

        .keyboard-shortcuts h4 {
            margin-bottom: 0.75rem;
            color: var(--primary-color);
        }

        .shortcut-list {
            list-style-type: none;
        }

        .shortcut-list li {
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }

        .shortcut-key {
            background-color: var(--primary-color);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            margin-right: 0.5rem;
            font-family: monospace;
            font-weight: 600;
        }

        /* Mobile warning styles */
        html.mobile-warning-shown,
        html.mobile-warning-shown body {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        .mobile-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.9);
            z-index: 1000;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            touch-action: none;
            -webkit-overflow-scrolling: none;
        }

        .mobile-warning-content {
            position: relative;
            width: min(90%, 300px);
            height: min(85vh, 600px);
            background: #ffffff;
            border-radius: 24px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: slideUpFade 0.5s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            overflow: hidden;
        }

        .mobile-warning-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            width: 100%;
            padding: 0.5rem;
            overflow: hidden;
        }

        .mobile-warning-illustration {
            width: 80px;
            height: 80px;
            flex-shrink: 0;
            border-radius: 40px;
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 12px 24px -8px rgba(99, 102, 241, 0.5);
            margin: 0 auto 0.5rem;
        }

        .mobile-warning-text {
            color: #1f2937;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            width: 100%;
        }

        .mobile-warning h2 {
            font-size: 1.125rem;
            font-weight: 700;
            line-height: 1.3;
            background: linear-gradient(135deg, #4f46e5, #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
            padding: 0;
        }

        .mobile-warning p {
            font-size: 0.875rem;
            line-height: 1.5;
            color: #4b5563;
            margin: 0;
            padding: 0;
        }

        .mobile-warning-actions {
            width: 100%;
            padding: 0.75rem 0 0;
            flex-shrink: 0;
        }

        .mobile-warning .btn-primary {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            padding: 0.75rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.875rem;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            border: none;
            width: 100%;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25);
            white-space: nowrap;
        }

        .mobile-warning .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(79, 70, 229, 0.3);
        }

        .mobile-warning .btn-primary:active {
            transform: translateY(0);
        }

        .mobile-warning .btn-primary svg {
            width: 14px;
            height: 14px;
            stroke-width: 2;
            flex-shrink: 0;
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile warning responsive adjustments */
        @media (max-width: 380px) {
            .mobile-warning-content {
                width: min(100%, 276px);
                height: min(90vh, 335px);
                padding: 1rem;
            }

            .mobile-warning-main {
                gap: 1rem;
            }

            .mobile-warning-illustration {
                width: 64px;
                height: 64px;
                border-radius: 32px;
            }

            .mobile-warning-text {
                gap: 0.75rem;
            }

            .mobile-warning h2 {
                font-size: 1rem;
            }

            .mobile-warning p {
                font-size: 0.8125rem;
            }

            .mobile-warning-actions {
                padding: 0.5rem 0 0;
            }

            .mobile-warning .btn-primary {
                padding: 0.625rem;
                font-size: 0.8125rem;
            }

            .mobile-warning .btn-primary svg {
                width: 12px;
                height: 12px;
            }
        }

        /* Loading overlay */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1001;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: white;
            backdrop-filter: blur(5px);
            padding: 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 2rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.2rem;
            font-weight: 500;
            text-align: center;
            max-width: 80%;
            line-height: 1.5;
            margin: 0 auto;
        }

        #loadingMessage {
            display: inline-block;
            text-align: center;
            width: 100%;
            max-width: 600px;
        }

        #loadingMessage span {
            display: inline;
            white-space: normal;
            word-wrap: break-word;
        }

        /* Loading container to ensure proper centering */
        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Updated panel styles */
        .paragraph-panel {
            min-height: 230px;
            max-height: 430px;
            background: var(--bg-card);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
            display: flex;
            flex-direction: column;
        }

        .paragraph-panel .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            padding-top: 8px;
            padding-bottom: 16px;
            scroll-behavior: smooth;
        }

        .paragraph-text {
            font-size: 1.05rem;
            line-height: 1.7;
            color: var(--text-color);
            padding: 0.25rem;
            padding-bottom: 28px;
        }

        /* Sentence styles */
        .sentence {
            display: inline;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            font-size: 15px;
        }

        .sentence.current {
            background-color: var(--current-sentence-bg);
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(99, 102, 241, 0.2);
            scroll-margin: 1rem;
        }

        /* Custom scrollbar for paragraph panel */
        .paragraph-panel .panel-content::-webkit-scrollbar {
            width: 8px;
        }

        .paragraph-panel .panel-content::-webkit-scrollbar-track {
            background: var(--bg-light);
            border-radius: 4px;
        }

        .paragraph-panel .panel-content::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 4px;
            border: 2px solid var(--bg-light);
        }

        .paragraph-panel .panel-content::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }

        /* Fade effect for long content */
        .paragraph-panel .panel-content::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: linear-gradient(to top, var(--bg-card), transparent);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .paragraph-panel .panel-content.has-overflow::after {
            opacity: 1;
        }

        .config-card h3 {
            font-size: 19px;
        }

        .translation-section {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-card);
            z-index: 5;
            padding: 12px;
            border-top: 1px solid var(--border-color);
        }

        /* Giảm kích thước nút để vừa vặn và gọn gàng hơn */
        .btn.warning, .hint-btn {
            padding: 0px 18px;
            font-size: 0.95rem;
            min-height: 49px;
            min-width: 120px;
        }

        .btn.primary {
            padding: 14px 24px;
            font-size: 0.95rem;
            min-height: 38px;
            min-width: 120px;
        }

        /* Điều chỉnh lại content container */
        .content-panel {
            height: auto;
            min-height: 91%;
            display: flex;
            flex-direction: column;
        }

        /* Điều chỉnh paragrah text */
        .paragraph-text {
            font-size: 1.05rem;
            line-height: 1.7;
            padding: 0.25rem;
            padding-bottom: 28px;
        }

        /* Điều chỉnh feedback content */
        .feedback-content {
            padding: 0.75rem;
        }

        /* Giảm khoảng cách của feedback panel */
        #generalFeedbackSection {
            margin-bottom: 1rem;
            padding: 1rem;
        }

        /* Responsive adjustments */
        @media (max-height: 800px) {
            .workspace-main {
                min-height: 650px;
            }
            
            .workspace-content {
                height: 650px;
            }
            
            .paragraph-panel {
                min-height: 200px;
                max-height: 400px;
            }
            
            .feedback-panel.visible {
                max-height: calc(100vh - 200px);
            }
        }

        /* Fix scrolling issues */
        html, body {
            scroll-behavior: smooth;
            overflow-x: hidden;
        }

        /* Chỉnh nút phím tắt nhỏ gọn hơn */
        #showShortcutsBtn {
            padding: 5px 12px;
            font-size: 0.85rem;
            height: 34px;
        }

        #suggestedSection {
            display: none; /* Hide by default */
            border-left-color: #D32F2F;
            background-color: #FFEBEE;
            margin-bottom: 1rem;
            padding: 1rem;
        }

        #suggestedSection.visible {
            display: block;
        }

        #suggestedSection h4 {
            color: #D32F2F;
            margin-bottom: 0.4rem;
        }

        #suggestedSection h4 svg {
            color: #D32F2F;
        }

        #highlightedSuggestion {
            line-height: 1.8;
            padding: 12px;
            border-radius: 6px;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            font-size: 0.95rem;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Make selectors more specific and add !important for critical styles */
        #suggestedSection #highlightedSuggestion strong,
        #suggestedSection #highlightedSuggestion .highlight {
            color: #D32F2F !important;
            font-weight: 600 !important;
            padding: 0 2px;
            display: inline-block;
            animation: highlight-glow 2s ease-in-out infinite;
        }

        @keyframes highlight-glow {
            0% { text-shadow: 0 0 2px rgba(211, 47, 47, 0.2); }
            50% { text-shadow: 0 0 8px rgba(211, 47, 47, 0.4); }
            100% { text-shadow: 0 0 2px rgba(211, 47, 47, 0.2); }
        }

        /* Ensure the section is visible when needed */
        #suggestedSection.visible {
            display: block !important;
        }

        /* Language select styles */
        .language-select {
            padding-left: 40px !important; /* Space for flag */
            position: relative;
            background-position: 10px center;
            background-repeat: no-repeat;
            background-size: 20px auto;
        }

        .language-select option {
            padding-left: 40px;
            height: 30px;
            display: flex;
            align-items: center;
        }

        .flag-svg {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            vertical-align: middle;
            border-radius: 2px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        /* Custom select with flags */
        .language-select-container {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .language-select-container::before {
            content: "";
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            pointer-events: none;
            background-size: contain;
            background-repeat: no-repeat;
        }

        .modal-content.info {
            border-top: 4px solid #2196F3;
        }

        .modal-content.info .modal-icon svg {
            stroke: #2196F3;
        }

        .practice-timer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            color: var(--primary-color);
            font-weight: 500;
            font-size: 1rem;
        }

        .practice-timer i {
            color: var(--primary-color);
        }

        #timer-display {
            min-width: 60px;
            text-align: center;
            font-family: monospace;
        }

        .workspace-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .content-type-selection {
            margin-top: 10px;
        }
        
        .content-type-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .content-type-option {
            display: block;
            cursor: pointer;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 12px;
            transition: all 0.2s ease;
        }
        
        .content-type-option:hover {
            background-color: #f5f5f5;
            transform: translateY(-2px);
        }
        
        .content-type-option input {
            position: absolute;
            opacity: 0;
        }
        
        .content-type-option input:checked + .option-content {
            color: #2196F3;
        }
        
        .content-type-option input:checked + .option-content .option-icon {
            color: #2196F3;
        }
        
        .content-type-option input:checked ~ .content-type-option {
            border-color: #2196F3;
            box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
        }
        
        .option-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .option-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background-color: #f5f5f5;
            border-radius: 50%;
            margin-bottom: 5px;
            color: #666;
        }
        
        .option-label {
            font-weight: 600;
            font-size: 16px;
        }
        
        .option-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-align: center;
        }

        /* Compact Extension Banner - Indigo Theme */
        .extension-highlight {
            background: linear-gradient(135deg, rgba(92, 107, 192, 0.08), rgba(121, 134, 203, 0.08));
            border: 2px solid rgba(92, 107, 192, 0.2);
            border-radius: 16px;
            padding: 0.75rem 1rem;
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .extension-highlight:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, rgba(92, 107, 192, 0.12), rgba(121, 134, 203, 0.12));
            border-color: rgba(92, 107, 192, 0.4);
            box-shadow: 0 8px 25px rgba(92, 107, 192, 0.15);
        }

        .extension-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #5c6bc0, #7986cb);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }

        .extension-highlight:hover .extension-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .extension-icon svg {
            width: 16px;
            height: 16px;
            stroke: white;
            stroke-width: 2.5;
        }

        .extension-text {
            font-size: 0.85rem;
            color: #5c6bc0;
            line-height: 1.4;
            font-weight: 500;
            flex: 1;
        }

        .extension-link {
            color: #5c6bc0;
            font-weight: 700;
            text-decoration: none;
            position: relative;
            background: linear-gradient(135deg, #5c6bc0, #7986cb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: all 0.3s ease;
        }

        .extension-link:after {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            bottom: -2px;
            left: 0;
            background: linear-gradient(135deg, #5c6bc0, #7986cb);
            transform: scaleX(0);
            transform-origin: right;
            transition: transform 0.3s ease;
        }

        .extension-link:hover:after {
            transform: scaleX(1);
            transform-origin: left;
        }

        /* Content type selection styles - ULTRA COMPACT */
        .content-type-section {
            padding: 0.5rem;
            padding-top: 3px;
            padding-bottom: 3px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-md);
        }

        .content-type-section h3 {
            color: var(--primary-color);
            font-size: 1rem;
            margin-bottom: 0.6rem;
            text-align: center;
            font-weight: 600;
        }

        .content-type-options {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.3rem;
        }

        .content-type-card {
            position: relative;
            flex: 1;
            padding: 0.6rem 0.4rem;
            border: 2px solid rgba(79, 195, 247, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: linear-gradient(135deg, rgba(79, 195, 247, 0.05), rgba(41, 182, 246, 0.05));
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 8px rgba(79, 195, 247, 0.08);
        }

        .content-type-card:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 20px rgba(79, 195, 247, 0.2);
            border-color: rgba(79, 195, 247, 0.5);
            background: linear-gradient(135deg, rgba(79, 195, 247, 0.08), rgba(41, 182, 246, 0.08));
        }

        .content-type-card input[type="radio"] {
            position: absolute;
            opacity: 0;
        }

        /* SELECTED STATE - Rõ ràng và nổi bật */
        .content-type-card input[type="radio"]:checked + .content-type-content {
            color: white;
        }

        .content-type-card input[type="radio"]:checked {
            ~ .content-type-check {
                background: #66bb6a;
                border-color: #66bb6a;
                opacity: 1;
                transform: scale(1);
                box-shadow: 0 0 0 3px rgba(102, 187, 106, 0.3);
            }
        }

        /* Card được chọn - Sky Blue theme */
        .content-type-card:has(input[type="radio"]:checked) {
            background: linear-gradient(135deg, #4fc3f7 0%, #29b6f6 100%) !important;
            border-color: #4fc3f7 !important;
            border-width: 3px !important;
            box-shadow: 0 6px 20px rgba(79, 195, 247, 0.3) !important;
            transform: translateY(-2px) scale(1.01) !important;
            position: relative;
        }

        /* Badge nhỏ gọn */
        .content-type-card:has(input[type="radio"]:checked)::before {
            content: "✓ CHỌN";
            position: absolute;
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            background: #66bb6a;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            z-index: 10;
            box-shadow: 0 2px 6px rgba(102, 187, 106, 0.3);
            border: 1px solid white;
        }

        .content-type-card:has(input[type="radio"]:checked) .content-type-title {
            color: white !important;
            font-weight: 600 !important;
        }

        .content-type-card:has(input[type="radio"]:checked) .content-type-description {
            color: rgba(255, 255, 255, 0.9) !important;
        }

        .content-type-card:has(input[type="radio"]:checked) .content-type-icon {
            background: rgba(255, 255, 255, 0.9) !important;
            color: #4fc3f7 !important;
            transform: scale(1.05) !important;
            box-shadow: 0 3px 12px rgba(255, 255, 255, 0.3) !important;
        }

        .content-type-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.4rem;
            text-align: center;
        }

        .content-type-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(79, 195, 247, 0.1), rgba(41, 182, 246, 0.1));
            color: #4fc3f7;
            margin-top: 2px;
            transition: all 0.3s ease;
            border: 2px solid rgba(79, 195, 247, 0.2);
        }

        .content-type-icon svg {
            width: 18px;
            height: 18px;
            stroke-width: 2;
        }

        .content-type-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #4fc3f7;
            transition: all 0.3s ease;
            line-height: 1.2;
        }

        .content-type-description {
            font-size: 0.7rem;
            color: rgba(79, 195, 247, 0.7);
            line-height: 1.2;
            margin-bottom: 2px;
            transition: all 0.3s ease;
        }

        .content-type-check {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: #66bb6a;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            border: 2px solid white;
            box-shadow: 0 2px 8px rgba(102, 187, 106, 0.3);
        }

        .content-type-check svg {
            width: 16px;
            height: 16px;
            stroke: currentColor;
            stroke-width: 3;
        }

        /* Legacy CSS - được thay thế bởi :has() selector phía trên */
        .content-type-card.selected {
            display: none; /* Ẩn để tránh conflict */
        }

        .content-type-card.selected .content-type-icon {
            display: none; /* Ẩn để tránh conflict */
        }

        .content-type-card.selected .content-type-check {
            display: none; /* Ẩn để tránh conflict */
        }

        /* Enhanced animation for selection */
        @keyframes checkmark-bounce {
            0% {
                transform: scale(0.5);
                opacity: 0;
            }
            50% {
                transform: scale(1.3);
                opacity: 0.8;
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes selected-card-glow {
            0% {
                box-shadow: 0 6px 20px rgba(79, 195, 247, 0.3);
            }
            50% {
                box-shadow: 0 8px 25px rgba(79, 195, 247, 0.4);
            }
            100% {
                box-shadow: 0 6px 20px rgba(79, 195, 247, 0.3);
            }
        }

        .content-type-card:has(input[type="radio"]:checked) .content-type-check {
            animation: checkmark-bounce 0.5s ease-out forwards;
        }

        .content-type-card:has(input[type="radio"]:checked) {
            animation: selected-card-glow 2s ease-in-out infinite;
        }

        /* Enhanced hover effects */
        .content-type-card:hover .content-type-icon {
            transform: scale(1.1);
            background: linear-gradient(135deg, rgba(79, 195, 247, 0.15), rgba(41, 182, 246, 0.15));
            border-color: rgba(79, 195, 247, 0.4);
        }

        .content-type-card:hover .content-type-title {
            color: #29b6f6;
        }

        .content-type-card:hover .content-type-description {
            color: rgba(41, 182, 246, 0.8);
        }

        /* Add focus styles for accessibility */
        .content-type-card input[type="radio"]:focus-visible + .content-type-content {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Simplified 3-Color Palette - Professional & Cohesive */
        
        /* Language selection card - Coral Pink */
        .config-card:nth-of-type(1) {
            background: linear-gradient(135deg, #ff6b6b 0%, #ffa8a8 100%);
            color: white;
            border-color: #ff6b6b;
        }
        
        .config-card:nth-of-type(1) h3 {
            color: white;
        }
        
        .config-card:nth-of-type(1) h3 svg {
            stroke: white;
        }
        
        .config-card:nth-of-type(1) .form-control {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #ff6b6b;
            font-weight: 600;
        }
        
        .config-card:nth-of-type(1) .form-control:focus {
            background: white;
            border-color: white;
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.3);
        }

        /* Topic selection card - Sky Blue */
        .config-card[data-mode-visibility="ai-only"]:nth-of-type(2) {
            background: linear-gradient(135deg, #4fc3f7 0%, #29b6f6 100%);
            color: white;
            border-color: #4fc3f7;
        }
        
        .config-card[data-mode-visibility="ai-only"]:nth-of-type(2) h3 {
            color: white;
        }
        
        .config-card[data-mode-visibility="ai-only"]:nth-of-type(2) h3 svg {
            stroke: white;
        }
        
        .config-card[data-mode-visibility="ai-only"]:nth-of-type(2) .form-control,
        .config-card[data-mode-visibility="ai-only"]:nth-of-type(2) label {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #29b6f6;
            font-weight: 600;
        }
        
        .config-card[data-mode-visibility="ai-only"]:nth-of-type(2) label {
            background: transparent;
            border: none;
            color: white;
        }

        /* Difficulty selection card - Mint Green */
        .config-card[data-mode-visibility="ai-only"]:nth-of-type(3) {
            background: linear-gradient(135deg, #26d0ce 0%, #1dd1a1 100%);
            color: white;
            border-color: #26d0ce;
        }
        
        .config-card[data-mode-visibility="ai-only"]:nth-of-type(3) h3 {
            color: white;
        }
        
        .config-card[data-mode-visibility="ai-only"]:nth-of-type(3) h3 svg {
            stroke: white;
        }
        
        .config-card[data-mode-visibility="ai-only"]:nth-of-type(3) .form-control {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #26d0ce;
            font-weight: 600;
        }

        /* Content type card - Orange Sunset */
        #contentTypeCard {
            background: linear-gradient(135deg, #ffa726 0%, #ffcc02 100%);
            color: white;
            border-color: #ffa726;
        }
        
        #contentTypeCard h3 {
            color: white;
        }
        
        #contentTypeCard h3 svg {
            stroke: white;
        }

        /* Vietnamese Text Input card - Simple Gray */
        #vietnameseTextCard {
            background: linear-gradient(135deg, #6b7280 0%, #9ca3af 100%);
            color: white;
            border-color: #6b7280;
        }
        
        #vietnameseTextCard h3 {
            color: white;
        }
        
        #vietnameseTextCard h3 svg {
            stroke: white;
        }
        
        #vietnameseTextCard .form-control {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #6b7280;
        }
        
        #vietnameseTextCard label {
            color: white;
            font-weight: 600;
        }

        /* Tabs styling */
        .tabs-container {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 0;
        }

        .tabs-nav {
            max-width: var(--content-max-width);
            margin: 0 auto;
            padding: 0 var(--container-padding);
            display: flex;
            gap: 0;
        }

        .tabs-nav.in-practice-mode {
            padding-left: 0px;
            margin-left: 0px;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }

        .tab-btn:hover {
            color: var(--primary-color);
            background: rgba(99, 102, 241, 0.05);
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: rgba(99, 102, 241, 0.05);
        }

        .tab-content {
            display: block;
        }

        .tab-content[style*="display: none"] {
            display: none !important;
        }

        /* History controls */
        .history-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .search-container {
            flex: 1;
            max-width: 400px;
        }

        .search-input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input-container svg {
            position: absolute;
            left: 1rem;
            color: var(--text-secondary);
            z-index: 1;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
            outline: none;
        }

        .filter-container {
            display: flex;
            gap: 0.5rem;
        }

        .filter-btn {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .filter-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .filter-btn.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        /* History list */
        .history-container {
            margin-bottom: 2rem;
            position: relative;
        }

        /* When in empty state, history-container should center its content */
        .history-container:has(.history-list.empty-state) {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        /* Fallback for browsers that don't support :has() */
        .history-container.empty-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }

        .history-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        /* Override grid layout when only no-history is shown */
        .history-list:has(.no-history:only-child) {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }

        /* Fallback for browsers that don't support :has() */
        .history-list.empty-state {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }

        .no-history {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .no-history-icon {
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        .no-history h3 {
            margin-bottom: 1rem;
            color: var(--text-color);
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .no-history-icon {
            margin-bottom: 1.5rem;
            opacity: 0.5;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .no-history p {
            margin: 0;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        /* Compact Statistics Section - Modern Design */
        .statistics-section.compact {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
            border: none;
            position: relative;
            overflow: hidden;
        }

        .statistics-section.compact::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            pointer-events: none;
        }

        .statistics-section.compact h3 {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }

        .stats-grid.compact {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
            position: relative;
            z-index: 1;
        }

        .stat-card.compact {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 1.2rem 1rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .stat-card.compact::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .stat-card.compact:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-card.compact:hover::before {
            left: 100%;
        }

        .stat-card.compact .stat-icon {
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        .stat-card.compact:hover .stat-icon {
            transform: scale(1.1) rotateY(10deg);
        }

        .stat-card.compact .stat-icon svg {
            color: white;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
            transition: all 0.3s ease;
        }

        .stat-card.compact:hover .stat-icon svg {
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
        }

        .stat-card.compact .stat-value {
            font-size: 1.6rem;
            font-weight: 800;
            color: white;
            margin-bottom: 0.25rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .stat-card.compact .stat-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        /* Charts Container */
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            position: relative;
            z-index: 1;
        }

        .chart-wrapper {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            padding: 1.2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .chart-wrapper::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, 
                transparent, 
                rgba(255,255,255,0.1), 
                transparent
            );
            transform: rotate(45deg);
            transition: all 0.5s ease;
            opacity: 0;
        }

        .chart-wrapper:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
        }

        .chart-wrapper:hover::before {
            opacity: 1;
            animation: shimmer 0.8s ease-in-out;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .chart-wrapper h4 {
            font-size: 0.9rem;
            color: white;
            margin-bottom: 0.75rem;
            text-align: center;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .chart-wrapper canvas {
            width: 100% !important;
            height: auto !important;
            max-height: 120px;
        }

        /* History Detail Modal Styles */
        .history-detail-header {
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 1rem;
        }

        .history-detail-header h2 {
            margin: 0 0 0.5rem 0;
            color: #1f2937;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .detail-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            font-size: 0.9rem;
            color: #6b7280;
        }

        .detail-meta span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .history-detail-content {
            overflow-y: auto;
            flex: 1;
            min-height: 0;
            padding-right: 0.5rem;
        }

        /* Custom scrollbar for history detail */
        .history-detail-content::-webkit-scrollbar {
            width: 6px;
        }

        .history-detail-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .history-detail-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .history-detail-content::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .sentences-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .detail-sentence {
            background: #f9fafb;
            border-radius: 8px;
            padding: 0.75rem;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
            margin-bottom: 0.75rem;
        }

        .detail-sentence:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .sentence-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.6rem;
            padding-bottom: 0.4rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .sentence-number {
            font-weight: 700;
            color: #6366f1;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin: 0;
        }

        .sentence-original,
        .sentence-translation,
        .sentence-feedback {
            margin-bottom: 0.6rem;
        }

        .sentence-original:last-child,
        .sentence-translation:last-child,
        .sentence-feedback:last-child {
            margin-bottom: 0;
        }

        .sentence-label {
            font-weight: 600;
            color: #374151;
            font-size: 0.8rem;
            margin-bottom: 0.3rem;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .sentence-text {
            background: white;
            padding: 0.6rem;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            line-height: 1.4;
            color: #1f2937;
            font-size: 0.9rem;
        }

        .score-value {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 16px;
            font-weight: 700;
            font-size: 0.85rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .feedback-text {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            padding: 0.6rem;
            border-radius: 6px;
            color: #92400e;
            line-height: 1.4;
            font-size: 0.9rem;
        }

        .overall-feedback {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #e5e7eb;
        }

        .overall-feedback h3 {
            margin: 0 0 1rem 0;
            color: #1f2937;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .overall-feedback p {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            padding: 1rem;
            border-radius: 8px;
            color: #0c4a6e;
            line-height: 1.6;
            margin: 0;
        }

        /* No History Empty State Styling */
        .no-history {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 3rem 2rem;
            min-height: 300px;
            color: #6b7280;
        }

        .no-history-icon {
            margin-bottom: 1.5rem;
            opacity: 0.7;
        }

        .no-history-icon svg {
            color: #9ca3af;
        }

        .no-history h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #374151;
            margin: 0 0 0.75rem 0;
        }

        .no-history p {
            font-size: 1rem;
            line-height: 1.6;
            color: #6b7280;
            margin: 0;
            max-width: 400px;
        }

        /* Modal responsive adjustments */
        @media (max-width: 768px) {
            .detail-meta {
                flex-direction: column;
                gap: 0.5rem;
            }

            .detail-sentence {
                padding: 0.6rem;
                margin-bottom: 0.6rem;
            }

            .sentence-header {
                margin-bottom: 0.5rem;
                padding-bottom: 0.3rem;
            }

            .sentence-number {
                font-size: 0.8rem;
            }

            .score-value {
                padding: 0.3rem 0.6rem;
                font-size: 0.8rem;
            }

            .sentence-original,
            .sentence-translation,
            .sentence-feedback {
                margin-bottom: 0.5rem;
            }

            .sentence-text {
                padding: 0.5rem;
                font-size: 0.85rem;
                line-height: 1.35;
            }

            .sentence-label {
                font-size: 0.75rem;
                margin-bottom: 0.25rem;
            }

            .feedback-text {
                padding: 0.5rem;
                line-height: 1.35;
            }

            .sentences-list {
                gap: 0.6rem;
            }

            .history-detail-content {
                padding-right: 0.25rem;
            }

            .no-history {
                padding: 2rem 1rem;
                min-height: 250px;
            }

            .no-history h3 {
                font-size: 1.125rem;
            }

            .no-history p {
                font-size: 0.9rem;
            }
        }

                /* Responsive adjustments for compact stats and history cards */
        @media (max-width: 768px) {
            .stats-grid.compact {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .stat-card.compact {
                padding: 1rem 0.8rem;
            }

            .stat-card.compact .stat-value {
                font-size: 1.4rem;
            }

            .stat-card.compact .stat-label {
                font-size: 0.75rem;
            }

            .charts-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .chart-wrapper {
                padding: 1rem;
            }

            .statistics-section.compact {
                padding: 1rem;
                margin-bottom: 1rem;
                border-radius: 12px;
            }

            .statistics-section.compact h3 {
                font-size: 1.1rem;
                margin-bottom: 0.8rem;
            }

            .history-list {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .history-card {
                padding: 0.75rem;
            }

            .history-card-title {
                font-size: 1rem;
            }

            .history-card-info {
                gap: 0.5rem;
            }

            .pagination-container {
                margin-top: 1rem;
                padding-top: 1rem;
            }

            .pagination-controls {
                gap: 0.25rem;
            }

            .pagination-btn {
                padding: 0.4rem 0.75rem;
                font-size: 0.8rem;
            }

            .pagination-number {
                padding: 0.4rem 0.6rem;
                font-size: 0.8rem;
                min-width: 36px;
            }
        }

        /* Dark mode and accessibility enhancements */
        @media (prefers-reduced-motion: reduce) {
            .stat-card.compact,
            .chart-wrapper,
            .stat-card.compact .stat-icon,
            .stat-card.compact .stat-icon svg {
                transition: none;
                animation: none;
            }
            
            .chart-wrapper::before,
            .stat-card.compact::before {
                display: none;
            }
        }

        .history-card {
            background: white;
            border-radius: var(--border-radius-sm);
            padding: 1rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .history-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .history-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .history-card-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 0.2rem;
            line-height: 1.3;
        }

        .history-card-language {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .history-card-actions {
            display: flex;
            gap: 0.25rem;
        }

        .history-action-btn {
            padding: 0.4rem;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.3s ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .history-action-btn svg {
            width: 14px;
            height: 14px;
        }

        .history-action-btn:hover {
            background: var(--bg-light);
        }

        .history-action-btn.bookmark.active {
            color: var(--warning-color);
        }

        .history-action-btn.delete:hover {
            color: var(--accent-color);
            background: rgba(244, 63, 94, 0.1);
        }

        .history-card-info {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .history-info-item {
            text-align: center;
        }

        .history-info-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.2rem;
        }

        .history-info-value {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .history-score {
            color: var(--success-color);
        }

        /* Pagination styles */
        .pagination-container {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .pagination-info {
            text-align: center;
            margin-bottom: 1rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .pagination-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
        }

        .pagination-btn {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover:not(:disabled) {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-numbers {
            display: flex;
            gap: 0.25rem;
        }

        .pagination-number {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border-color);
            background: white;
            border-radius: var(--border-radius-sm);
            font-size: 0.9rem;
            color: var(--text-color);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 40px;
            text-align: center;
        }

        .pagination-number:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .pagination-number.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .pagination-ellipsis {
            padding: 0.5rem 0.25rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Loading state for history */
        .history-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 3rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .history-loading .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 0.75rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Smooth transitions for history cards */
        .history-card {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.3s ease forwards;
        }

        .history-card:nth-child(2) { animation-delay: 0.1s; }
        .history-card:nth-child(3) { animation-delay: 0.2s; }
        .history-card:nth-child(4) { animation-delay: 0.3s; }
        .history-card:nth-child(5) { animation-delay: 0.4s; }
        .history-card:nth-child(6) { animation-delay: 0.5s; }
        .history-card:nth-child(7) { animation-delay: 0.6s; }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Statistics section smooth appearance */
        .statistics-section.compact {
            opacity: 0;
            transform: translateY(-10px);
            animation: fadeInDown 0.4s ease forwards;
        }

        @keyframes fadeInDown {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Statistics section */
        .statistics-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 2rem;
            border: 1px solid var(--border-color);
        }

        .statistics-section h3 {
            margin-bottom: 1.5rem;
            color: var(--text-color);
            font-size: 1.5rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .stat-content {
            flex: 1;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-color);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .chart-container {
            background: var(--bg-light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* History detail modal styles */
        .history-detail-header {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }

        .history-detail-header h2 {
            margin: 0 0 0.5rem 0;
            color: var(--text-color);
        }

        .detail-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .detail-meta span {
            padding: 0.25rem 0.75rem;
            background: var(--bg-light);
            border-radius: var(--border-radius);
        }

        .sentences-list {
            margin-bottom: 2rem;
        }

        .detail-sentence {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .sentence-number {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .sentence-label {
            font-weight: 500;
            color: var(--text-color);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sentence-text {
            background: var(--bg-light);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1rem;
            line-height: 1.6;
        }

        .sentence-original .sentence-text {
            border-left: 4px solid var(--primary-color);
        }

        .sentence-translation .sentence-text {
            border-left: 4px solid var(--secondary-color);
        }

        .sentence-score {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .score-value {
            background: var(--success-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .sentence-feedback .sentence-text {
            border-left: 4px solid var(--warning-color);
            background: rgba(245, 158, 11, 0.1);
        }

        .overall-feedback {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border-left: 4px solid var(--primary-color);
        }

        .overall-feedback h3 {
            margin: 0 0 1rem 0;
            color: var(--text-color);
        }

        .overall-feedback p {
            margin: 0;
            line-height: 1.6;
            color: var(--text-secondary);
        }

        /* Modern Mode Selection - COMPACT VERSION */
        .mode-selection-container {
            margin-bottom: 1rem;
        }

        .mode-selection {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 16px;
            padding: 1rem;
            box-shadow: 0 6px 25px rgba(99, 102, 241, 0.2);
            border: none;
            position: relative;
            overflow: hidden;
        }

        .mode-selection::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            pointer-events: none;
        }

        .mode-selection h3 {
            text-align: center;
            margin-bottom: 1.2rem;
            color: white;
            font-size: 1.3rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }

        .mode-options {
            display: flex;
            gap: 1rem;
            position: relative;
            z-index: 1;
        }

        .mode-option {
            flex: 1;
            position: relative;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            display: block;
        }

        .mode-option:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.15);
        }

        .mode-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .mode-option.selected {
            background: rgba(255, 255, 255, 0.9);
            border-color: rgba(255, 255, 255, 0.8);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
        }

        .mode-content {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            position: relative;
            z-index: 1;
        }

        .mode-icon {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .mode-option.selected .mode-icon {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: scale(1.1);
        }

        .mode-icon svg {
            width: 20px;
            height: 20px;
        }

        .mode-details {
            flex: 1;
            min-width: 0;
        }

        .mode-title {
            font-size: 1rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.2rem;
            transition: color 0.3s ease;
        }

        .mode-option.selected .mode-title {
            color: #667eea;
        }

        .mode-description {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.8);
            line-height: 1.3;
            transition: color 0.3s ease;
        }

        .mode-option.selected .mode-description {
            color: #764ba2;
        }

        .mode-check {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #66bb6a;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .mode-option.selected .mode-check {
            opacity: 1;
            transform: scale(1);
        }

        .mode-check svg {
            width: 12px;
            height: 12px;
            stroke-width: 3;
        }

        /* Vietnamese Input Card - Bright & Simple Theme */
        .vietnamese-input-card {
            background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%) !important;
            border: 2px solid #22c55e !important;
            box-shadow: 0 4px 20px rgba(34, 197, 94, 0.1) !important;
        }

        .vietnamese-input-card h3 {
            color: #22c55e !important;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .vietnamese-input-card .form-group label {
            color: #16a34a !important;
            font-weight: 600;
        }

        /* Vietnamese Text Input Styles - COMPACT */
        .vietnamese-text-input {
            min-height: 120px;
            max-height: 200px;
            resize: vertical;
            font-size: 0.9rem;
            line-height: 1.5;
            padding: 0.75rem;
            background: #ffffff !important;
            border: 2px solid #bbf7d0 !important;
            border-radius: 12px !important;
        }

        .vietnamese-text-input:focus {
            border-color: #22c55e !important;
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.1) !important;
            outline: none;
        }

        .vietnamese-text-input::placeholder {
            color: #6b7280 !important;
            opacity: 1;
            font-weight: 400;
        }

        .input-validation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.4rem;
            margin-bottom: 0.75rem;
        }

        .char-counter {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .char-counter.warning {
            color: var(--warning-color);
        }

        .char-counter.error {
            color: var(--accent-color);
        }

        .validation-messages {
            font-size: 0.8rem;
            color: var(--accent-color);
        }

        .vietnamese-input-card .input-hints {
            background: rgba(34, 197, 94, 0.05) !important;
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: var(--border-radius-sm);
            padding: 0.75rem;
            margin-top: 0.75rem;
        }

        .vietnamese-input-card .hint-item {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
            color: #16a34a !important;
        }

        .vietnamese-input-card .hint-item:last-child {
            margin-bottom: 0;
        }

        .vietnamese-input-card .hint-item svg {
            flex-shrink: 0;
        }

        .vietnamese-input-card .char-counter {
            color: #16a34a !important;
            font-weight: 600;
        }

        .vietnamese-input-card .char-counter.warning {
            color: #f59e0b !important;
        }

        .vietnamese-input-card .char-counter.error {
            color: #ef4444 !important;
        }

        /* Dynamic Config Grid Styles */
        .config-grid.mode-ai-generated {
            grid-template-columns: repeat(4, 1fr);
        }

        .config-grid.mode-user-input {
            grid-template-columns: repeat(2, 1fr);
        }

        /* Default mode visibility - AI_GENERATED is default */
        .config-card[data-mode-visibility="ai-only"] {
            display: block;
        }

        .config-card[data-mode-visibility="user-only"] {
            display: none;
        }

        /* Mode-specific visibility rules */
        .mode-user-input .config-card[data-mode-visibility="ai-only"] {
            display: none;
        }

        .mode-user-input .config-card[data-mode-visibility="user-only"] {
            display: block;
        }

        .mode-ai-generated .config-card[data-mode-visibility="ai-only"] {
            display: block;
        }

        .mode-ai-generated .config-card[data-mode-visibility="user-only"] {
            display: none;
        }

        /* Content type card visibility */
        #contentTypeCard {
            display: block;
        }

        .mode-user-input #contentTypeCard {
            display: none;
        }

        #vietnameseTextCard {
            display: none;
        }

        .mode-user-input #vietnameseTextCard {
            display: block;
        }

        /* Smooth transitions for mode switching */
        .config-grid {
            transition: all 0.3s ease;
        }

        .config-card {
            transition: all 0.3s ease;
        }

        /* Animation for mode switching */
        @keyframes fadeInCard {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .config-card.fade-in {
            animation: fadeInCard 0.3s ease forwards;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .mode-options {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .mode-option {
                padding: 1rem;
            }

            .mode-content {
                gap: 0.75rem;
            }

            .mode-icon {
                width: 40px;
                height: 40px;
            }

            .mode-title {
                font-size: 1rem;
            }

            .mode-description {
                font-size: 0.85rem;
            }

            .config-grid.mode-ai-generated,
            .config-grid.mode-user-input {
                grid-template-columns: 1fr;
            }

            .vietnamese-text-input {
                min-height: 150px;
                max-height: 200px;
            }

            .input-validation {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .tabs-nav {
                padding: 0 1rem;
            }

            .tab-btn {
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }

            .history-controls {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }

            .search-container {
                max-width: none;
            }

            .history-card-info {
                grid-template-columns: repeat(2, 1fr);
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .detail-meta {
                flex-direction: column;
                gap: 0.5rem;
            }

            .detail-sentence {
                padding: 1rem;
            }

            /* Enhanced mobile responsive for new design */
            .config-grid {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .config-card {
                min-width: unset;
                padding: 1rem;
            }
            
            .mode-options {
                flex-direction: column;
                gap: 0.75rem;
            }
            
            .mode-selection {
                padding: 1.25rem;
            }
            
            .extension-highlight {
                padding: 0.75rem;
                gap: 0.5rem;
            }
            
            .extension-text {
                font-size: 0.8rem;
            }
            
            .content-type-options {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            h2 {
                font-size: 1.5rem !important;
            }
        }

        @media (max-width: 480px) {
            .mode-selection h3 {
                font-size: 1.1rem;
            }
            
            .config-card h3 {
                font-size: 1rem;
            }
            
            .submit-btn {
                padding: 0.875rem 1.5rem;
                font-size: 1rem;
            }

            .mode-option {
                padding: 0.875rem;
            }

            .extension-icon {
                width: 28px;
                height: 28px;
            }
        }

        /* Points display styling */
        .points-display {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            color: var(--warning-color);
            font-weight: 500;
            background: rgba(245, 158, 11, 0.1);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .points-display svg {
            flex-shrink: 0;
        }

        .points-label {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .points-value {
            color: var(--warning-color);
            font-weight: 600;
            font-size: 0.9rem;
            min-width: 20px;
            text-align: center;
        }

        /* Fix translation input padding to prevent text overlap with speech button */
        .translation-input {
            padding-right: 55px !important; /* Override existing padding for speech button */
            line-height: 1.5 !important; /* Improve line spacing */
        }

        /* Responsive adjustment for mobile */
        @media (max-width: 768px) {
            .translation-input {
                padding-right: 45px !important; /* Reduce padding on mobile */
            }
        }

        /* Enhanced mobile warning button styles */
        .mobile-warning-actions {
            display: flex !important;
            flex-direction: column !important;
            gap: 0.75rem !important;
            align-items: center !important;
            width: 100% !important;
            padding: 0.75rem 0 0 !important;
        }

        .mobile-warning-button {
            background: linear-gradient(135deg, #6366f1, #4f46e5) !important;
            color: white !important;
            padding: 0.875rem 1.5rem !important;
            border-radius: 12px !important;
            font-weight: 600 !important;
            font-size: 0.875rem !important;
            text-decoration: none !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            gap: 0.5rem !important;
            transition: all 0.2s ease !important;
            border: none !important;
            min-width: 180px !important;
            max-width: 220px !important;
            width: 100% !important;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.25) !important;
            white-space: nowrap !important;
            cursor: pointer !important;
        }

        .mobile-warning-button.secondary {
            background: linear-gradient(135deg, #10b981, #059669) !important;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25) !important;
        }

        .mobile-warning-button:hover {
            transform: translateY(-1px) !important;
            box-shadow: 0 6px 16px rgba(79, 70, 229, 0.3) !important;
        }

        .mobile-warning-button.secondary:hover {
            box-shadow: 0 6px 16px rgba(16, 185, 129, 0.3) !important;
        }

        .mobile-warning-button:active {
            transform: translateY(0) !important;
        }

        .mobile-warning-button svg {
            width: 16px !important;
            height: 16px !important;
            stroke-width: 2 !important;
            flex-shrink: 0 !important;
        }

        /* Mobile responsive adjustments for buttons */
        @media (max-width: 380px) {
            .mobile-warning-button {
                min-width: 160px !important;
                max-width: 200px !important;
                padding: 0.75rem 1.25rem !important;
                font-size: 0.8125rem !important;
            }

            .mobile-warning-button svg {
                width: 14px !important;
                height: 14px !important;
            }
        }

        /* AI Guide Icon */
        .ai-guide-icon {
            margin-left: 0.5rem;
            font-size: 1.2rem;
            animation: ai-bounce 2s infinite;
        }

        @keyframes ai-bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-5px);
            }
            60% {
                transform: translateY(-3px);
            }
        }

        /* Motivational Quotes */
        .motivational-quotes-container {
            margin-top: 16px;
            padding: 12px 16px;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 12px;
            border-left: 4px solid var(--success-color);
            position: relative;
            overflow: hidden;
        }

        .motivational-quote {
            font-style: italic;
            font-size: 0.9rem;
            color: var(--text-color);
            text-align: center;
            opacity: 1;
            font-weight: 500;
            line-height: 1.4;
            transform: translateY(0);
            transition: opacity 0.6s ease-in-out, transform 0.6s ease-in-out;
        }

        .motivational-quote.animated {
            animation: fadeInOut 6s infinite;
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: translateY(10px);
            }
            15% {
                opacity: 1;
                transform: translateY(0);
            }
            85% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-10px);
            }
        }

        /* Responsive design for motivational quotes */
        @media (max-width: 768px) {
            .motivational-quotes-container {
                margin-top: 12px;
                padding: 10px 12px;
            }

            .motivational-quote {
                font-size: 0.85rem;
                line-height: 1.3;
            }

            .ai-guide-icon {
                font-size: 1.1rem;
            }
        }

        @media (max-width: 480px) {
            .motivational-quotes-container {
                margin-top: 10px;
                padding: 8px 10px;
            }

            .motivational-quote {
                font-size: 0.8rem;
                line-height: 1.25;
            }

            .ai-guide-icon {
                font-size: 1rem;
            }
        }

        /* Feedback button styles */
        .feedback-button {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            color: white;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(4px);
        }

        .feedback-button:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.4);
            transform: translateY(-1px);
        }

        .feedback-button:active {
            transform: translateY(0);
        }

        .feedback-button svg {
            flex-shrink: 0;
        }
    </style>
</head>
<body>
    <!-- Mobile Warning -->
    <div class="mobile-warning">
        <div class="mobile-warning-content">
            <div class="mobile-warning-header">
                <div class="mobile-warning-icon">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                        <line x1="8" y1="21" x2="16" y2="21"/>
                        <line x1="12" y1="17" x2="12" y2="21"/>
                    </svg>
                </div>
                <h2 class="mobile-warning-title">Thiết bị không được hỗ trợ</h2>
            </div>
            
            <div class="mobile-warning-features">
                <h3>🌟 Tính năng luyện dịch chuyên nghiệp</h3>
                <div class="feature-list">
                    <div class="feature-item">
                        <div class="feature-icon">🎯</div>
                        <div class="feature-text">
                            <strong>Dịch từng câu đơn</strong> từ tiếng Việt sang tiếng Anh, Trung, Nhật, Hàn, Đức với sự gợi ý và nhận xét bởi AI
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">🚀</div>
                        <div class="feature-text">
                            <strong>2 chế độ chuyên biệt:</strong> Cải thiện nhanh giao tiếp hằng ngày hoặc nâng cao học thuật như IELTS
                        </div>
                    </div>
                    <div class="feature-item">
                        <div class="feature-icon">📊</div>
                        <div class="feature-text">
                            <strong>Báo cáo thống kê</strong> lịch sử luyện tập và mức độ tiến bộ chi tiết
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mobile-warning-notice">
                <div class="notice-icon">💻</div>
                <p>Hiện tại chức năng này chỉ hỗ trợ trên các thiết bị màn hình lớn như máy tính, laptop để đảm bảo trải nghiệm tốt nhất. Vui lòng sử dụng máy tính hoặc laptop để luyện tập.</p>
            </div>
        </div>
        
        <div class="mobile-warning-actions">
            <button class="mobile-warning-button primary" onclick="window.location.href='/dashboard'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
                Về trang chủ
            </button>
            <button class="mobile-warning-button secondary" onclick="redirectToPractice()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                </svg>
                Luyện từ vựng
            </button>
        </div>
    </div>

    <!-- Loading overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-container">
            <div class="loading-spinner"></div>
            <div class="loading-text">
                <div id="loadingMessage">Đang tạo bài luyện viết...</div>
            </div>
        </div>
    </div>

    <!-- Main content container -->
    <div class="container">
        <header>
            <a href="/" class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#6366f1" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                Vi-Translator
            </a>
            <div class="header-actions">
                <a class="btn secondary" onclick="redirectToPractice()">Luyện Tập Từ</a>
                <a href="/dashboard" class="btn secondary">Trang Chủ</a>
                </div>
        </header>

        <!-- Navigation tabs -->
        <div class="tabs-container">
            <div class="tabs-nav">
                <button class="tab-btn active" data-tab="practice-tab">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                    </svg>
                    Tạo bài luyện viết mới
                </button>
                <button class="tab-btn" data-tab="history-tab">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 4v6h6M23 20v-6h-6"></path>
                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                    </svg>
                    Lịch sử luyện tập
                </button>
            </div>
            </div>
            
        <!-- Practice config section -->
        <div class="config-section tab-content" id="practice-tab">
            <!-- Extension highlight banner -->
            <div class="extension-highlight">
                <div class="extension-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path>
                        <line x1="16" y1="8" x2="2" y2="22"></line>
                        <line x1="17.5" y1="15" x2="9" y2="15"></line>
                    </svg>
                        </div>
                <div class="extension-text">
                    Tải & cài đặt thêm extension: <a href="/" class="extension-link">Vi-Translator</a> để tra cứu & lưu trữ lại từ vựng mới & ngữ pháp câu chưa biết.
                    </div>
                        </div>

            <h2 style="
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                text-align: center;
                font-size: 2rem;
                font-weight: 800;
                margin-bottom: 1.5rem;
                letter-spacing: -0.025em;
                line-height: 1.2;
            ">✨ Tạo bài luyện viết mới</h2>
            
            <!-- Mode Selection -->
            <div class="mode-selection-container">
                <div class="mode-selection">
                    <h3>Chọn cách tạo bài luyện tập</h3>
                    <div class="mode-options">
                        <label class="mode-option selected" data-mode="AI_GENERATED">
                            <input type="radio" name="practiceMode" value="AI_GENERATED" checked>
                            <div class="mode-content">
                                <div class="mode-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                                    </svg>
                    </div>
                                <div class="mode-details">
                                    <div class="mode-title">Tạo bài từ chủ đề</div>
                                    <div class="mode-description">AI tạo nội dung dựa trên chủ đề bạn chọn</div>
                        </div>
                    </div>
                            <div class="mode-check">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                        </label>
                        
                        <label class="mode-option" data-mode="USER_INPUT">
                            <input type="radio" name="practiceMode" value="USER_INPUT">
                            <div class="mode-content">
                                <div class="mode-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                        <line x1="10" y1="9" x2="8" y2="9"/>
                                    </svg>
                                </div>
                                <div class="mode-details">
                                    <div class="mode-title">Nhập đoạn văn của bạn</div>
                                    <div class="mode-description">Sử dụng đoạn văn tiếng Việt do bạn cung cấp</div>
                                </div>
                            </div>
                            <div class="mode-check">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            
            <div class="config-grid" id="configGrid">
                <div class="config-card">
                    <h3>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4f46e5" stroke-width="2">
                            <path d="M21 10H3M21 6H3M21 14H3M21 18H3"></path>
                        </svg>
                        Chọn ngôn ngữ viết
                    </h3>
                    <div class="form-group">
                        <select id="targetLanguage" class="form-control language-select">
                            <option value="English" data-flag='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" class="flag-svg"><clipPath id="gb"><path d="M0 0v30h60V0z"/></clipPath><path d="M0 0v30h60V0z" fill="#012169"/><path d="M0 0l60 30m0-30L0 30" stroke="#fff" stroke-width="6"/><path d="M0 0l60 30m0-30L0 30" clip-path="url(#gb)" stroke="#C8102E" stroke-width="4"/><path d="M30 0v30M0 15h60" stroke="#fff" stroke-width="10"/><path d="M30 0v30M0 15h60" stroke="#C8102E" stroke-width="6"/></svg>'>Tiếng Anh</option>
                            <option value="Japanese" data-flag='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600" class="flag-svg"><rect width="900" height="600" fill="#fff"/><circle cx="450" cy="300" r="180" fill="#bc002d"/></svg>'>Tiếng Nhật</option>
                            <option value="Korean" data-flag='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -4 28 28" class="flag-svg"><g clip-path="url(#clip0_503_3460)"><rect x="0.25" y="0.25" width="27.5" height="19.5" rx="1.75" fill="white" stroke="#F5F5F5" stroke-width="0.5"/><mask id="mask0_503_3460" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="28" height="20"><rect x="0.25" y="0.25" width="27.5" height="19.5" rx="1.75" fill="white" stroke="white" stroke-width="0.5"/></mask><g mask="url(#mask0_503_3460)"><path fill-rule="evenodd" clip-rule="evenodd" d="M14 14.6667C16.5773 14.6667 18.6667 12.5773 18.6667 10C18.6667 7.42268 16.5773 5.33334 14 5.33334C11.4227 5.33334 9.33334 7.42268 9.33334 10C9.33334 12.5773 11.4227 14.6667 14 14.6667Z" fill="#E01B41"/><mask id="mask1_503_3460" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="9" y="5" width="10" height="10"><path fill-rule="evenodd" clip-rule="evenodd" d="M14 14.6667C16.5773 14.6667 18.6667 12.5773 18.6667 10C18.6667 7.42268 16.5773 5.33334 14 5.33334C11.4227 5.33334 9.33334 7.42268 9.33334 10C9.33334 12.5773 11.4227 14.6667 14 14.6667Z" fill="white"/></mask><g mask="url(#mask1_503_3460)"><path fill-rule="evenodd" clip-rule="evenodd" d="M9.33335 10.6667C10.6667 11.9167 12.6667 12.6667 14 10.6667C15.3333 8.66669 18 8.66669 18.6667 10.6667C19.3333 12.6667 18.6667 14.6667 18.6667 14.6667H9.33335C9.33335 14.6667 8.00001 9.41669 9.33335 10.6667Z" fill="#0E4B9C"/></g><path opacity="0.75" fill-rule="evenodd" clip-rule="evenodd" d="M6.17308 3.55661C6.26513 3.39718 6.46899 3.34256 6.62842 3.43461L7.20577 3.76794C7.3652 3.85999 7.41983 4.06385 7.32778 4.22328L5.66111 7.11003C5.56907 7.26946 5.3652 7.32409 5.20577 7.23204L4.62842 6.89871C4.46899 6.80666 4.41437 6.6028 4.50641 6.44337L6.17308 3.55661ZM20.7942 3.76794C20.6348 3.85999 20.5802 4.06385 20.6722 4.22328L22.3389 7.11003C22.4309 7.26946 22.6348 7.32409 22.7942 7.23204L23.3716 6.89871C23.531 6.80666 23.5856 6.6028 23.4936 6.44337L21.8269 3.55661C21.7349 3.39718 21.531 3.34256 21.3716 3.43461L20.7942 3.76794ZM19.0622 4.76794C18.9027 4.85999 18.8481 5.06385 18.9402 5.22328L20.6068 8.11003C20.6989 8.26946 20.9027 8.32409 21.0622 8.23204L21.6395 7.89871C21.799 7.80666 21.8536 7.6028 21.7615 7.44337L20.0949 4.55661C20.0028 4.39718 19.799 4.34256 19.6395 4.43461L19.0622 4.76794ZM4.50641 13.5566C4.41437 13.3972 4.46899 13.1933 4.62842 13.1013L5.20577 12.7679C5.3652 12.6759 5.56907 12.7305 5.66111 12.8899L7.32778 15.7767C7.41983 15.9361 7.3652 16.14 7.20577 16.232L6.62842 16.5654C6.46899 16.6574 6.26513 16.6028 6.17308 16.4434L4.50641 13.5566ZM6.36047 12.1013C6.20104 12.1933 6.14642 12.3972 6.23847 12.5566L7.90513 15.4434C7.99718 15.6028 8.20104 15.6574 8.36047 15.5654L8.93782 15.232C9.09725 15.14 9.15188 14.9361 9.05983 14.7767L7.39317 11.8899C7.30112 11.7305 7.09725 11.6759 6.93782 11.7679L6.36047 12.1013ZM20.6068 11.8899C20.6989 11.7305 20.9027 11.6759 21.0622 11.7679L21.6395 12.1013C21.799 12.1933 21.8536 12.3972 21.7615 12.5566L20.0949 15.4434C20.0028 15.6028 19.799 15.6574 19.6395 15.5654L19.0622 15.232C18.9027 15.14 18.8481 14.9361 18.9402 14.7767L20.6068 11.8899ZM22.7942 12.7679C22.6348 12.6759 22.4309 12.7305 22.3389 12.8899L20.6722 15.7767C20.5802 15.9361 20.6348 16.14 20.7942 16.232L21.3716 16.5654C21.531 16.6574 21.7349 16.6028 21.8269 16.4434L23.4936 13.5566C23.5856 13.3972 23.531 13.1933 23.3716 13.1013L22.7942 12.7679ZM8.36047 4.43461C8.20104 4.34256 7.99718 4.39718 7.90513 4.55661L6.23846 7.44337C6.14642 7.6028 6.20104 7.80666 6.36047 7.89871L6.93782 8.23204C7.09725 8.32409 7.30112 8.26946 7.39317 8.11003L9.05983 5.22328C9.15188 5.06385 9.09725 4.85999 8.93782 4.76794L8.36047 4.43461Z" fill="#262626"/></g></g><defs><clipPath id="clip0_503_3460"><rect width="28" height="20" rx="2" fill="white"/></clipPath></defs></svg>'>Tiếng Hàn</option>
                            <option value="Chinese" data-flag='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600" class="flag-svg"><rect width="900" height="600" fill="#de2910"/><g fill="#ffde00"><path d="M 5,20 L 15,40 L 25,20 L 15,25 Z" transform="translate(225,120) scale(6)"/><path d="M 5,20 L 15,40 L 25,20 L 15,25 Z" transform="translate(305,115) rotate(23) scale(4)"/><path d="M 5,20 L 15,40 L 25,20 L 15,25 Z" transform="translate(315,175) rotate(45) scale(4)"/><path d="M 5,20 L 15,40 L 25,20 L 15,25 Z" transform="translate(295,235) rotate(70) scale(4)"/><path d="M 5,20 L 15,40 L 25,20 L 15,25 Z" transform="translate(235,235) rotate(90) scale(4)"/></g></svg>'>Tiếng Trung</option>
                            <option value="German" data-flag='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 5 3" class="flag-svg"><rect width="5" height="3" y="0" x="0" fill="#000"/><rect width="5" height="2" y="1" x="0" fill="#D00"/><rect width="5" height="1" y="2" x="0" fill="#FFCE00"/></svg>'>Tiếng Đức</option>
                            <option value="French" data-flag='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 3 2" class="flag-svg"><rect width="1" height="2" x="0" fill="#002395"/><rect width="1" height="2" x="1" fill="#fff"/><rect width="1" height="2" x="2" fill="#ED2939"/></svg>'>Tiếng Pháp</option>
                            <option value="Spanish" data-flag='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 500" class="flag-svg"><rect width="750" height="500" fill="#c60b1e"/><rect width="750" height="250" y="125" fill="#ffc400"/></svg>'>Tiếng Tây Ban Nha</option>
                        </select>
                    </div>
            </div>
            
                <div class="config-card" data-mode-visibility="ai-only">
                    <h3>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4f46e5" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                        </svg>
                        Chọn chủ đề luyện tập
                    </h3>
                    <div class="form-group">
                        <div class="topic-list">
                            <div class="form-group">
                                <select id="predefinedTopic" class="form-control">
                                    <option value="">-- Chọn chủ đề --</option>
                                    <optgroup label="Giao tiếp hằng ngày">
                                        <option value="daily_conversation">Hội thoại hằng ngày</option>
                                        <option value="greetings">Chào hỏi và xã giao</option>
                                        <option value="shopping">Mua sắm</option>
                                        <option value="restaurant">Nhà hàng và đặt món</option>
                                        <option value="transportation">Di chuyển và giao thông</option>
                                        <option value="asking_directions">Hỏi đường</option>
                                        <option value="weather_talk">Trò chuyện về thời tiết</option>
                                    </optgroup>
                                    <optgroup label="Công việc">
                                        <option value="job_interview">Phỏng vấn việc làm</option>
                                        <option value="office_communication">Giao tiếp văn phòng</option>
                                        <option value="business_meeting">Họp và thảo luận</option>
                                        <option value="email_writing">Viết email công việc</option>
                                        <option value="presentation">Thuyết trình</option>
                                    </optgroup>
                                    <optgroup label="Học tập">
                                        <option value="self_introduction">Giới thiệu bản thân</option>
                                        <option value="school_life">Cuộc sống học đường</option>
                                        <option value="study_abroad">Du học</option>
                                        <option value="academic_discussion">Thảo luận học thuật</option>
                                    </optgroup>
                                    <optgroup label="Đời sống">
                                        <option value="daily_routine">Thói quen hằng ngày</option>
                                        <option value="hobbies">Sở thích và giải trí</option>
                                        <option value="family_life">Gia đình</option>
                                        <option value="travel_experience">Du lịch</option>
                                        <option value="food_and_dining">Ẩm thực</option>
                                        <option value="health">Sức khỏe và y tế</option>
                                    </optgroup>
                                    <optgroup label="Xã hội">
                                        <option value="social_media">Mạng xã hội</option>
                                        <option value="environment">Môi trường</option>
                                        <option value="technology">Công nghệ</option>
                                        <option value="culture">Văn hóa</option>
                                        <option value="current_events">Thời sự</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="customTopic">Hoặc nhập chủ đề tự chọn:</label>
                            <input type="text" id="customTopic" class="form-control" placeholder="Nhập chủ đề bạn muốn luyện tập...">
                        </div>
                    </div>
                </div>
                
                <div class="config-card" data-mode-visibility="ai-only">
                    <h3>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4f46e5" stroke-width="2">
                            <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                            <line x1="4" y1="22" x2="4" y2="15"></line>
                        </svg>
                        Chọn mức độ khó
                    </h3>
                    <div class="form-group">
                        <select id="selectedDifficulty" name="difficulty" class="form-control">
                            <option value="1">🌱 Dễ</option>
                            <option value="2" selected>🌿 Khá dễ</option>
                            <option value="3">🌳 Trung bình</option>
                            <option value="4">🎯 Khó</option>
                            <option value="5">🏆 Rất khó</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- Content Type Selection - only shown in AI_GENERATED mode -->
            <div class="config-card" id="contentTypeCard">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4f46e5" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                    Loại nội dung
                </h3>
                <div class="content-type-section">
                    <div class="content-type-options">
                        <label class="content-type-card">
                            <input type="radio" name="contentType" value="DIALOGUE" checked>
                            <div class="content-type-content">
                                <div class="content-type-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                </div>
                                <div class="content-type-title">Hội thoại</div>
                                <div class="content-type-description">
                                    Đối thoại giữa các nhân vật, thích hợp cho cải thiện nhanh giao tiếp
                                </div>
                            </div>
                            <div class="content-type-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                        </label>
                        
                        <label class="content-type-card">
                            <input type="radio" name="contentType" value="PARAGRAPH">
                            <div class="content-type-content">
                                <div class="content-type-icon">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14 2 14 8 20 8"/>
                                        <line x1="16" y1="13" x2="8" y2="13"/>
                                        <line x1="16" y1="17" x2="8" y2="17"/>
                                        <line x1="10" y1="9" x2="8" y2="9"/>
                                    </svg>
                                </div>
                                <div class="content-type-title">Đoạn văn</div>
                                <div class="content-type-description">
                                    Nội dung mô tả liên tục, thích hợp cho luyện tập Ielts
                                </div>
                            </div>
                            <div class="content-type-check">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- Vietnamese Text Input - only shown in USER_INPUT mode -->
            <div class="config-card vietnamese-input-card" id="vietnameseTextCard" data-mode-visibility="user-only" style="display: none;">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <line x1="10" y1="9" x2="8" y2="9"/>
                    </svg>
                    Nhập đoạn văn tiếng Việt
                </h3>
                <div class="form-group">
                    <label for="vietnameseText">Nhập đoạn văn tiếng Việt của bạn:</label>
                    <textarea 
                        id="vietnameseText" 
                        class="form-control vietnamese-text-input" 
                        placeholder="Nhập đoạn văn tiếng Việt để AI tách thành các câu cho bài luyện dịch...
                        
Ví dụ: Hôm nay là một ngày đẹp trời. Tôi quyết định đi dạo trong công viên gần nhà. Những chiếc lá vàng rơi nhẹ nhàng trên đường. Không khí trong lành và mát mẻ làm tôi cảm thấy rất thoải mái."
                        rows="8"
                        maxlength="4000"></textarea>
                    <div class="input-validation">
                        <div class="char-counter">
                            <span id="charCount">0</span>/<span id="maxChars">700</span> từ
                        </div>
                        <div class="validation-messages" id="validationMessages"></div>
                    </div>
                    <div class="input-hints">
                        <div class="hint-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <path d="M9 12l2 2 4-4"></path>
                                <circle cx="12" cy="12" r="10"></circle>
                            </svg>
                            <span>Gợi ý: 150-700 từ, 5-15 câu cho hiệu quả tốt nhất</span>
                        </div>
                        <div class="hint-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#0ea5e9" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                            </svg>
                            <span>AI sẽ tự động tách đoạn văn thành các câu riêng biệt</span>
                        </div>
                        <div class="hint-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                                <path d="M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"></path>
                            </svg>
                            <span>Nội dung phù hợp với ngôn ngữ đích bạn đã chọn</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="submit-row">
                <button id="startPracticeBtn" class="btn primary submit-btn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="#ffffff" stroke="none">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                    Bắt đầu luyện viết
                </button>
            </div>
        </div>

        <!-- History tab section -->
        <div class="config-section tab-content" id="history-tab" style="display: none;">
            <h2>Lịch sử luyện tập</h2>
            
            <!-- Statistics section - moved up -->
            <div class="statistics-section compact" id="statisticsSection" style="display: none;">
                <h3>Thống kê tiến bộ</h3>
                <div class="stats-grid compact">
                    <div class="stat-card compact">
                        <div class="stat-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14,2 14,8 20,8"></polyline>
                                <line x1="16" y1="13" x2="8" y2="13"></line>
                                <line x1="16" y1="17" x2="8" y2="17"></line>
                                <polyline points="10,9 9,9 8,9"></polyline>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalPractices">0</div>
                            <div class="stat-label">Tổng bài luyện tập</div>
                        </div>
                    </div>
                    
                    <div class="stat-card compact">
                        <div class="stat-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="8 14s1.5 2 4 2 4-2 4-2"></path>
                                <line x1="9" y1="9" x2="9.01" y2="9"></line>
                                <line x1="15" y1="9" x2="15.01" y2="9"></line>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="averageScore">0</div>
                            <div class="stat-label">Điểm trung bình</div>
                        </div>
                    </div>
                    
                    <div class="stat-card compact">
                        <div class="stat-icon">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="bestScore">0</div>
                            <div class="stat-label">Điểm cao nhất</div>
                        </div>
                    </div>
                </div>
                
                <!-- Charts container -->
                <div class="charts-container">
                    <!-- Frequency chart -->
                    <div class="chart-wrapper frequency-chart">
                        <h4>Tần suất luyện tập</h4>
                        <canvas id="frequencyChart" width="400" height="120"></canvas>
                    </div>
                    
                    <!-- Progress chart -->
                    <div class="chart-wrapper progress-chart">
                        <h4>Tiến bộ điểm số</h4>
                        <canvas id="progressChart" width="400" height="120"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Search and filters -->
            <div class="history-controls">
                <div class="search-container">
                    <div class="search-input-container">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input type="text" id="historySearch" placeholder="Tìm kiếm theo chủ đề..." class="search-input">
                    </div>
                </div>
                
                <div class="filter-container">
                    <button class="filter-btn active" data-filter="all">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                        Tất cả
                </button>
                    <button class="filter-btn" data-filter="bookmarked">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                        </svg>
                        Đã đánh dấu
                    </button>
                </div>
            </div>
            
            <!-- History list -->
            <div class="history-container">
                <div class="history-list" id="historyList">
                    <div class="no-history" id="noHistory">
                        <div class="no-history-icon">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M1 4v6h6M23 20v-6h-6"></path>
                                <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"></path>
                            </svg>
                        </div>
                        <h3>Chưa có lịch sử luyện tập</h3>
                        <p>Hãy hoàn thành bài luyện tập đầu tiên để xem lịch sử tại đây</p>
                    </div>
                    
                    <!-- History items will be inserted here dynamically -->
                </div>
                
                <!-- Pagination controls -->
                <div class="pagination-container" id="paginationContainer" style="display: none;">
                    <div class="pagination-info">
                        <span id="paginationInfo">Hiển thị 1-6 của 20 bài luyện tập</span>
                    </div>
                    <div class="pagination-controls">
                        <button class="pagination-btn" id="prevBtn" disabled>
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6"></polyline>
                            </svg>
                            Trước
                        </button>
                        
                        <div class="pagination-numbers" id="paginationNumbers">
                            <!-- Page numbers will be inserted here -->
                        </div>
                        
                        <button class="pagination-btn" id="nextBtn">
                            Sau
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            

        </div>

        <!-- Writing workspace section -->
        <div class="writing-workspace" id="writingWorkspace">
            <div class="workspace-header">
                <div class="workspace-title-container">
                    <h2 id="workspaceTitle" style="font-size: 24px">Luyện viết tiếng Anh</h2>
                    <div class="workspace-meta">
                        <span id="workspaceTopic">Chủ đề: Giới thiệu bản thân</span> | 
                        <span id="workspaceDifficulty">Độ khó: 3/5</span> | 
                        <span id="workspacePoints" class="points-display" title="Mỗi lần tạo bài mới, kiểm tra bản dịch, hoặc xem gợi ý sẽ tiêu tốn 1 point">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                            <span class="points-label">Points còn lại:</span>
                            <span id="remainingPoints" class="points-value">...</span>
                        </span>
                    </div>
                </div>
                <div class="workspace-controls">
                    <button id="showShortcutsBtn" class="btn secondary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#6366f1" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="7" y1="8" x2="17" y2="8"></line>
                            <line x1="7" y1="12" x2="17" y2="12"></line>
                            <line x1="7" y1="16" x2="17" y2="16"></line>
                        </svg>
                        Phím tắt
                    </button>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-stats">
                    <span id="progressText">0/0 câu</span>
                    <span id="progressPercent">0%</span>
                </div>
            </div>
            
            <div class="workspace-main">
                <!-- Combined content panel -->
                <div class="workspace-content">
                    <!-- Paragraph panel -->
                    <div class="content-panel paragraph-panel">
                        <div class="panel-header">
                            <div class="panel-header-left">
                                <span>Đoạn văn song ngữ</span>
                                <div id="practice-timer" class="practice-timer" style="display: none;">
                                    <i class="fas fa-clock"></i>
                                    <span id="timer-display">00:00</span>
                                </div>
                            </div>
                            <span id="currentSentenceNumber">Câu 1/10</span>
                        </div>
                        <div class="panel-content">
                            <div class="paragraph-text" id="paragraphText">
                                <!-- Paragraph content will be inserted here dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Translation input section - moved outside -->
                    <div class="translation-section">
                        <div id="translationArea">
                            <div class="translation-input-container">
                                <textarea id="translationInput" class="translation-input" placeholder="Nhập bản dịch của bạn..."></textarea>
                                <button id="speechToTextBtn" class="speech-btn" title="Nhấn để ghi âm">
                                    <svg class="mic-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                        <line x1="12" y1="19" x2="12" y2="23"></line>
                                        <line x1="8" y1="23" x2="16" y2="23"></line>
                                    </svg>
                                    <div class="recording-pulse"></div>
                                </button>
                                <div id="speechStatus" class="speech-status" style="display: none;">
                                    <span class="status-text">Đang nghe...</span>
                                </div>
                            </div>
                            
                            <div class="translation-actions">
                                <button id="hintBtn" class="btn warning hint-btn enabled">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="#ffffff" stroke="none">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" stroke="#ffffff" stroke-width="2"></path>
                                        <line x1="12" y1="17" x2="12.01" y2="17" stroke="#ffffff" stroke-width="2"></line>
                                    </svg>
                                    <span id="hintBtnText">Xem gợi ý</span>
                                </button>
                                <button id="checkTranslationBtn" class="btn primary">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2">
                                        <polyline points="20 6 9 17 4 12"></polyline>
                                    </svg>
                                    Kiểm tra
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Right column for AI feedback -->
                <div class="content-panel feedback-container">
                    <div class="panel-header">
                        <span id="feedbackHeaderText">Trợ lý học tập AI của bạn</span>
                        <button class="feedback-button" id="feedbackButton" onclick="openFeedbackGroup()"
                                title="Góp ý và thảo luận">
                            <svg fill="none" height="14" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                                 width="14">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            Góp ý
                        </button>
                    </div>
                    <div class="panel-content feedback-content">
                        <!-- Feedback content (moved from feedbackPanel) -->
                        <div class="feedback-header">
                            <div class="feedback-result" id="feedbackResult" style="display: none;">Đang chờ đánh giá
                            </div>
                            <div class="feedback-score" id="feedbackScore" style="display: none;">--/10</div>
                        </div>
                        <div class="feedback-body">
                            <div class="feedback-section" id="generalFeedbackSection">
                                <h4 id="titleGeneralFeedbackSection">
                                    <svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                                         width="16">
                                        <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                                    </svg>
                                    Hướng dẫn luyện tập
                                    <span class="ai-guide-icon">🤖</span>
                                </h4>
                                <p id="generalFeedback" style="line-height: 1.8; margin-bottom: 0;">
                                    <span style="display: block; margin-bottom: 12px;">Click vào button "Gợi ý" nếu bạn gặp khó khăn, AI sẽ giúp bạn 💡</span>
                                    <span style="display: block; margin-bottom: 16px;">Hãy click vào button "Kiểm tra" để AI review và đánh giá câu dịch của bạn ✅</span>
                                <div class="motivational-quotes-container">
                                    <div class="motivational-quote" id="motivationalQuote">
                                        🌍 "Mỗi từ bạn học là một bước gần hơn đến thế giới mới."
                                    </div>
                                </div>
                                </p>
                            </div>

                            <div class="feedback-section" id="improvementsSection" style="display:none;">
                                <h4>
                                    <svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                                         width="16">
                                        <path d="M12 20h9"></path>
                                        <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"></path>
                                    </svg>
                                    Điểm cần cải thiện
                                </h4>
                                <ul class="improvements-list" id="improvementsList">
                                    <!-- Improvements will be inserted here dynamically -->
                                </ul>
                            </div>

                            <div class="feedback-section" id="suggestedSection" style="display:none;">
                                <h4>
                                    <svg fill="none" height="16" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
                                         width="16">
                                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path>
                                    </svg>
                                    Gợi ý cải thiện nâng cao
                                </h4>
                                <p id="highlightedSuggestion">Gợi ý cải thiện sẽ xuất hiện ở đây.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Completion summary (initially hidden) -->
            <div class="completion-summary" id="completionSummary">
                <div class="summary-header">
                    <h2>Chúc mừng! Bạn đã hoàn thành bài tập</h2>
                    <p>Dưới đây là đánh giá chi tiết của chúng tôi về bài dịch của bạn</p>
                    <span class="overall-score" id="overallScore">85</span>
                </div>
                
                <div class="summary-sections">
                    <div class="summary-section">
                        <h3>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                                <path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>
                            </svg>
                            Điểm mạnh
                        </h3>
                        <ul class="summary-list" id="strengthPoints">
                            <!-- Strength points will be inserted here dynamically -->
                        </ul>
                    </div>
                    
                    <div class="summary-section">
                        <h3>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#f43f5e" stroke-width="2">
                                <path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path>
                            </svg>
                            Cần cải thiện
                        </h3>
                        <ul class="summary-list" id="improvementAreas">
                            <!-- Improvement areas will be inserted here dynamically -->
                        </ul>
                    </div>
                    
                    <div class="summary-section">
                        <h3>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#0ea5e9" stroke-width="2">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                            </svg>
                            Cấu trúc ngữ pháp gợi ý
                        </h3>
                        <ul class="summary-list" id="recommendedGrammar">
                            <!-- Recommended grammar structures will be inserted here dynamically -->
                        </ul>
                    </div>
                    
                    <div class="summary-section">
                        <h3>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2">
                                <path d="M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"></path>
                                <polygon points="18 2 22 6 12 16 8 16 8 12 18 2"></polygon>
                            </svg>
                            Từ vựng gợi ý
                        </h3>
                        <ul class="summary-list" id="recommendedVocabulary">
                            <!-- Recommended vocabulary will be inserted here dynamically -->
                        </ul>
                    </div>
                </div>
                
                <div class="summary-actions">
                    <button id="newPracticeBtn" class="btn primary">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2">
                            <path d="M3 2v6h6"></path>
                            <path d="M3 13a9 9 0 1 0 3-7.7L3 8"></path>
                        </svg>
                        Tạo bài luyện mới
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Keyboard shortcuts panel -->
        <div class="keyboard-shortcuts" id="keyboardShortcuts">
            <h4>Phím tắt</h4>
            <ul class="shortcut-list">
                <li><span class="shortcut-key">Tab</span> Bắt đầu nhập</li>
                <li><span class="shortcut-key">Ctrl + Enter</span> Kiểm tra</li>
                <li><span class="shortcut-key">Alt + H</span> Hiện gợi ý</li>
                <li><span class="shortcut-key">Alt + R</span> Bật/tắt ghi âm</li>
                <li><span class="shortcut-key">Esc</span> Ẩn panel / Dừng ghi âm</li>
            </ul>
        </div>
    </div>

    <!-- Add hint popup HTML -->
    <div class="hint-overlay" id="hintOverlay"></div>

    <!-- Include history management scripts -->
    <script src="/js/history/indexed-db.js"></script>
    <script src="/js/history/history-manager.js"></script>
    <script src="/js/history/history-ui.js"></script>
    
    <!-- Include speech-to-text components -->
    <script src="/js/utils/language-mapper.js"></script>
    <script src="/js/components/speech-to-text.js"></script>
    
    <!-- Include mode management components -->
    <script src="/js/components/mode-manager.js"></script>
    <script src="/js/components/input-validator.js"></script>
    
    <!-- Include tab management -->
    <script src="/js/components/tab-manager.js"></script>
    <div class="hint-popup" id="hintPopup">
        <div class="hint-popup-header">
            <h3>Gợi ý</h3>
            <button class="hint-popup-close" id="closeHintBtn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="hint-popup-content">
            <div class="hint-section">
                <h4>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                    Từ vựng
                </h4>
                <div class="vocabulary-list" id="hintVocabulary">
                    <!-- Vocabulary items will be inserted here -->
                </div>
            </div>
            <div class="hint-section" id="structureSection">
                <h4>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="4 7 4 4 20 4 20 7"></polyline>
                        <line x1="9" y1="20" x2="15" y2="20"></line>
                        <line x1="12" y1="4" x2="12" y2="20"></line>
                    </svg>
                    Cấu trúc câu
                </h4>
                <div class="sentence-structure" id="hintStructure">
                    <!-- Sentence structure will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>&copy; 2025 Vi Translator. All rights reserved. | <a href="/privacy-policy">Chính sách quyền riêng tư</a></p>
    </footer>

    <script>
        // Enhanced mobile detection - only phones, not tablets
        function isMobileDevice() {
            // Check for mobile user agent (excluding tablets)
            const mobileUserAgent = /Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

            // Exclude tablets and large devices
            const isTablet = /iPad|Android.*(?!.*Mobile)/i.test(navigator.userAgent);

            // Check screen size - consider phone if width <= 768px
            const isSmallScreen = window.innerWidth <= 768;
            
            // Check for touch capability but exclude Windows touch devices
            const isTouchDevice = (('ontouchstart' in window) || 
                                 (navigator.maxTouchPoints > 0) || 
                                 (navigator.msMaxTouchPoints > 0)) &&
                                 !(/Windows NT/i.test(navigator.userAgent));

            // Only show popup for actual phones (not tablets)
            return mobileUserAgent && isTouchDevice && !isTablet && isSmallScreen;
        }

        // Show mobile warning with smooth transition
        function showMobileWarning() {
            const mobileWarning = document.querySelector('.mobile-warning');
            const mainContent = document.querySelector('.container');
            
            if (isMobileDevice()) {
                // Prevent scrolling on the main content
                document.documentElement.classList.add('mobile-warning-shown');
                mobileWarning.style.display = 'flex';
                mainContent.style.filter = 'blur(5px)';
                mainContent.style.pointerEvents = 'none';
            } else {
                // Reset all styles when not on mobile
                document.documentElement.classList.remove('mobile-warning-shown');
                mobileWarning.style.display = 'none';
                mainContent.style.filter = '';
                mainContent.style.pointerEvents = '';
            }
        }

        // Initial check
        showMobileWarning();

        // Recheck on orientation change and resize for better detection
        window.addEventListener('orientationchange', showMobileWarning);
        window.addEventListener('resize', showMobileWarning);

        // Handle back button and history
        window.addEventListener('popstate', function(event) {
            if (isMobileDevice()) {
                window.location.href = '/';
            }
        });

        // Motivational Quotes Logic
        const motivationalQuotes = [
            '🌍 Mỗi từ bạn học là một bước gần hơn đến thế giới mới.',
            '💪 Học ngoại ngữ không phải là khó, chỉ cần từng ngày một cố gắng.',
            '🎯 Luyện tập hôm nay, tự tin nói ngày mai.',
            '🌉 Học ngoại ngữ là xây cầu nối đến những nền văn hóa mới.',
            '✨ Sai lầm là bằng chứng bạn đang tiến bộ.',
            '📖 Chỉ cần một từ mỗi ngày, bạn sẽ chinh phục cả ngôn ngữ.',
            '🔑 Ngôn ngữ là chìa khóa mở cánh cửa giao tiếp toàn cầu.',
            '🌟 Học ngoại ngữ không chỉ học từ vựng, mà là học cách sống mới.',
            '🕒 Thành công bắt đầu từ những điều nhỏ bé bạn làm mỗi ngày.',
            '🚀 Mỗi lần bạn luyện tập, bạn đang tiến gần hơn đến mục tiêu.',
            '💡 Đừng sợ thất bại, hãy sợ việc không thử.',
            '🛤️ Học ngoại ngữ là hành trình, không phải đích đến.',
            '🌈 Một ngôn ngữ mới là một cuộc sống mới.',
            '🏆 Bạn không cần hoàn hảo, chỉ cần tiến bộ.',
            '🎁 Học một ngôn ngữ là trao tặng chính mình một món quà suốt đời.',
            '🐢 Người kiên nhẫn học ngoại ngữ, là người sẽ làm chủ nó.',
            '⏳ Thời gian bạn dành cho ngôn ngữ hôm nay sẽ là thành quả ngày mai.',
            '🌱 Mỗi ngày một chút, điều kỳ diệu sẽ xảy ra.',
            '🌍 Ngôn ngữ mới là một cơ hội mới.',
            '🎓 Không ai giỏi ngay từ đầu, nhưng ai cũng có thể giỏi nếu cố gắng.',
            '🔥 Chỉ cần kiên trì, bạn sẽ ngạc nhiên với chính mình.',
            '👓 Học ngoại ngữ giúp bạn nhìn thế giới qua đôi mắt khác.',
            '💭 Hãy nhớ lý do tại sao bạn bắt đầu, và tiếp tục bước tới.',
            '🚪 Ngôn ngữ là cánh cửa dẫn đến những cơ hội bất ngờ.',
            '🖋️ Mỗi lần bạn học, bạn đang viết nên câu chuyện thành công của chính mình.',
            '🌌 Học ngoại ngữ là một hành trình khám phá không giới hạn.',
            '📚 Kiến thức không có ranh giới, ngôn ngữ sẽ dẫn bạn đi xa.',
            '🐾 Dù chậm nhưng đừng dừng lại.',
            '📜 Một từ vựng hôm nay là một câu chuyện ngày mai.',
            '🧗 Bước đi từng bước nhỏ, bạn sẽ leo đến đỉnh núi cao.',
            '🎯 Đặt mục tiêu nhỏ mỗi ngày và để Trợ lý AI giúp bạn đạt được chúng.',
            '✍️ Viết đi, đừng ngại! Trợ lý AI sẽ giúp bạn kiểm tra và cải thiện mỗi câu.',
            '🛠️ Trợ lý học tập AI của bạn luôn sẵn sàng giúp bạn hoàn thiện từng câu chữ.',
            '🤖 Đừng lo lắng, Trợ lý AI luôn ở đây để đồng hành cùng bạn mỗi bước.',
            '📈 Mỗi câu bạn viết, Trợ lý AI sẽ giúp bạn giỏi hơn một chút.',
            '🧠 Trợ lý AI không chỉ sửa lỗi mà còn giúp bạn hiểu rõ vì sao.',
            '🙌 Học không cô đơn – bạn luôn có một Trợ lý AI bên cạnh.',
            '🗝️ Trợ lý AI là chiếc chìa khóa giúp bạn mở cánh cửa thành thạo ngôn ngữ.',
            '🚧 Lỗi không phải là thất bại – đó là nguyên liệu cho tiến bộ, cùng AI!',
            '💬 Viết, sửa, hiểu – Trợ lý AI giúp bạn lặp lại điều đó mỗi ngày.',
            '🎉 Mỗi câu hoàn chỉnh là một chiến thắng nhỏ – và Trợ lý AI sẽ ăn mừng cùng bạn!'
        ];

        let currentQuoteIndex = 0;
        let usedQuotes = [];
        let quotesInitialized = false;
        let quotesInterval = null;

        function updateMotivationalQuote() {
            const quoteElement = document.getElementById('motivationalQuote');

            if (quoteElement) {
                const newQuote = getRandomQuote();

                // Smooth transition
                quoteElement.style.opacity = '0';
                quoteElement.style.transform = 'translateY(10px)';

                setTimeout(() => {
                    quoteElement.textContent = newQuote;
                    quoteElement.style.opacity = '1';
                    quoteElement.style.transform = 'translateY(0)';
                }, 600);
            }
        }

        // Initialize quotes immediately 
        function initMotivationalQuotes() {
            // Prevent duplicate initialization
            if (quotesInitialized) {
                return;
            }
            
            const quoteElement = document.getElementById('motivationalQuote');

            if (quoteElement) {
                quotesInitialized = true;

                // Clear any existing interval
                if (quotesInterval) {
                    clearInterval(quotesInterval);
                }

                // Set initial quote immediately
                const initialQuote = getRandomQuote();
                quoteElement.textContent = initialQuote;
                quoteElement.classList.add('animated');

                // Change quote every 15 seconds
                quotesInterval = setInterval(updateMotivationalQuote, 15000);
            }
        }

        function getRandomQuote() {
            // Reset used quotes if all have been used
            if (usedQuotes.length >= motivationalQuotes.length) {
                usedQuotes = [];
            }

            let availableQuotes = motivationalQuotes.filter((_, index) => !usedQuotes.includes(index));

            let randomIndex = Math.floor(Math.random() * availableQuotes.length);
            let selectedQuoteIndex = motivationalQuotes.indexOf(availableQuotes[randomIndex]);

            usedQuotes.push(selectedQuoteIndex);
            return motivationalQuotes[selectedQuoteIndex];
        }

        // Function to open feedback group
        function openFeedbackGroup() {
            window.open('https://docs.google.com/forms/d/e/1FAIpQLSfjz19LbB801S-vZ_9Ri7oE-wd4SD1hdyDCQWqbqSUEMxT1Xg/viewform?usp=dialog', '_blank');
        }

        // Start motivational quotes when page loads
        document.addEventListener('DOMContentLoaded', function () {

            // Debug: Check if element exists immediately
            const debugElement = document.getElementById('motivationalQuote');

            // Also check if container exists
            const container = document.querySelector('.motivational-quotes-container');

            // Check if generalFeedbackSection exists
            const section = document.getElementById('generalFeedbackSection');

            // Check all elements with motivational in ID or class
            const allMotivational = document.querySelectorAll('[id*="motivational"], [class*="motivational"]');

            // Check if the HTML structure is there
            const feedbackBody = document.querySelector('.feedback-body');
            // Initialize quotes immediately
            initMotivationalQuotes();

            // Retry with delays if not found (but limit attempts)
            let retryCount = 0;
            [500, 1000, 2000].forEach(delay => {
                setTimeout(() => {
                    const delayedElement = document.getElementById('motivationalQuote');
                    if (delayedElement && !quotesInitialized && retryCount < 3) {
                        retryCount++;
                        initMotivationalQuotes();
                    }
                }, delay);
            });

            // MutationObserver to watch for DOM changes - only if not initialized yet
            const observer = new MutationObserver(function (mutations) {
                if (!quotesInitialized) {
                    const element = document.getElementById('motivationalQuote');
                    if (element) {
                        initMotivationalQuotes();
                        observer.disconnect(); // Stop observing once found
                    }
                }
            });

            observer.observe(document.body, {childList: true, subtree: true});

            // Auto-disconnect observer after 10 seconds to prevent memory leaks
            setTimeout(() => observer.disconnect(), 10000);
        });

        // Listen for quotes restored event from JS file
        document.addEventListener('motivationalQuotesRestored', function () {
            // Reset initialization flag and reinitialize only if needed
            if (quotesInitialized) {
                quotesInitialized = false;
                if (quotesInterval) {
                    clearInterval(quotesInterval);
                    quotesInterval = null;
                }
            }
            initMotivationalQuotes();
        });
    </script>
    <!-- Authentication utilities -->
    <script src="/js/auth-utils.js"></script>
    <script src="/js/auth-guard.js"></script>
    
    <script>
        // Authentication management for write-practice page
        let userDropdownOpen = false;
        
        // Toggle user dropdown
        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdownMenu');
            userDropdownOpen = !userDropdownOpen;
            dropdown.classList.toggle('show', userDropdownOpen);
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('userDropdown');
            if (dropdown && !dropdown.contains(event.target) && userDropdownOpen) {
                toggleUserDropdown();
            }
        });
        
        // Logout function
        function logoutUser() {
            // Clear auth data and redirect
            AuthUtils.removeToken();
            window.location.href = '/login';
        }
        
        // Initialize authentication on page load
        document.addEventListener('DOMContentLoaded', async function() {
            const token = AuthUtils.getToken();
            const userDropdown = document.getElementById('userDropdown');
            const loginButton = document.getElementById('loginButton');
            
            if (token) {
                const isValid = await AuthUtils.validateToken();
                if (isValid) {
                    // User is authenticated
                    if (userDropdown) {
                        userDropdown.style.display = 'block';
                    }
                    if (loginButton) {
                        loginButton.style.display = 'none';
                    }
                    
                    // Load user info from localStorage 
                    const user = AuthUtils.getUser();
                    if (user) {
                        const userAvatar = document.getElementById('userAvatar');
                        const userDisplayName = document.getElementById('userDisplayName');
                        
                        if (userAvatar) {
                            userAvatar.textContent = user.name ? user.name.charAt(0).toUpperCase() : 'U';
                        }
                        if (userDisplayName) {
                            userDisplayName.textContent = user.name || user.email;
                        }
                    }
                } else {
                    // Token invalid, show login button
                    if (userDropdown) {
                        userDropdown.style.display = 'none';
                    }
                    if (loginButton) {
                        loginButton.style.display = 'inline-flex';
                    }
                }
            } else {
                // User is not authenticated
                if (userDropdown) {
                    userDropdown.style.display = 'none';
                }
                if (loginButton) {
                    loginButton.style.display = 'inline-flex';
                }
            }
        });

        // Navigate to practice dashboard with user's active API key
        async function redirectToPractice() {
            // Show loading overlay
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loadingMessage = document.getElementById('loadingMessage');

            if (loadingOverlay) {
                if (loadingMessage) {
                    loadingMessage.textContent = 'Đang chuyển đến trang luyện từ vựng...';
                }
                loadingOverlay.style.display = 'flex';
            }

            try {
                const response = await fetch('/api/dashboard/active-key', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('authToken')}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    // Update loading message
                    if (loadingMessage) {
                        loadingMessage.textContent = 'Đang tải trang luyện từ vựng...';
                    }
                    // Redirect to practice dashboard with email and apiKey
                    window.location.href = `/practice/dashboard?email=${encodeURIComponent(data.email)}&apiKey=${encodeURIComponent(data.apiKey)}`;
                } else {
                    // Hide loading overlay before showing alert
                    if (loadingOverlay) {
                        loadingOverlay.style.display = 'none';
                    }
                    // If no active API key, show alert
                    alert('Không tìm thấy API key hoạt động. Vui lòng tạo API key mới trong tab "Quản lý API".');
                    window.location.href = '/dashboard';
                }
            } catch (error) {
                console.error('Error getting active API key:', error);
                // Hide loading overlay before showing alert
                if (loadingOverlay) {
                    loadingOverlay.style.display = 'none';
                }
                alert('Có lỗi xảy ra khi lấy thông tin API key. Vui lòng thử lại.');
            }
        }
    </script>
    
    <script src="/js/write-practice.js"></script>
</body>
</html> 